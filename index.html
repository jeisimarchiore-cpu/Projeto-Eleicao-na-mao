<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise Eleitoral Estrat√©gica - Gabriel Gabe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://npmcdn.com/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 65vh;
            width: 100%;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .location-row {
            cursor: pointer;
        }
        .main-tab.active {
            border-bottom: 2px solid #06b6d4;
            color: #06b6d4;
        }
        .bairro-map-item {
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }
        .bairro-map-item:hover, .bairro-map-item.selected {
            transform: scale(1.05);
            border-color: #06b6d4;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Cabe√ßalho -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-white mb-2">Painel de An√°lise Estrat√©gica</h1>
            <p class="text-xl text-cyan-400" id="candidateName">Gabriel Gabe (PSD)</p>
        </header>

        <!-- Abas de Navega√ß√£o Principal -->
        <div class="mb-8 border-b border-gray-700 flex justify-center">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button id="tab-2024" class="main-tab active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg">
                    An√°lise 2024
                </button>
                <button id="tab-2028" class="main-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg text-gray-400 hover:text-cyan-400">
                    Ecossistema de Campanha 2028
                </button>
            </nav>
        </div>

        <!-- Conte√∫do da Aba 2024 -->
        <div id="content-2024" class="space-y-8">
            <!-- M√©tricas Principais -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center transition-transform hover:scale-105">
                    <h2 class="text-lg font-semibold text-gray-400 mb-2">Total de Votos</h2>
                    <p class="text-5xl font-bold text-white" id="totalVotes">-</p>
                </div>
                 <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center transition-transform hover:scale-105">
                    <h2 class="text-lg font-semibold text-gray-400 mb-2">Locais Alcan√ßados</h2>
                    <p class="text-5xl font-bold text-white" id="totalLocations">-</p>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center transition-transform hover:scale-105">
                    <h2 class="text-lg font-semibold text-gray-400 mb-2">Local de Maior Vota√ß√£o</h2>
                    <p class="text-2xl font-bold text-cyan-400 text-center" id="strongestLocationName">-</p>
                     <p class="text-lg text-gray-300" id="strongestLocationVotes">- votos</p>
                </div>
                 <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center ring-2 ring-teal-400 transition-transform hover:scale-105">
                    <h2 class="text-lg font-semibold text-gray-400 mb-2">Maior Penetra√ß√£o</h2>
                    <p class="text-2xl font-bold text-teal-400 text-center" id="highestPenetrationLocation">-</p>
                     <p class="text-lg text-gray-300" id="highestPenetrationValue">-</p>
                </div>
                <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center ring-2 ring-amber-400 transition-transform hover:scale-105">
                    <h2 class="text-lg font-semibold text-gray-400 mb-2">Maior Oportunidade</h2>
                    <p class="text-2xl font-bold text-amber-400 text-center" id="highestAbstentionLocation">-</p>
                     <p class="text-lg text-gray-300" id="highestAbstentionValue">- absten√ß√µes</p>
                </div>
            </div>
            
            <!-- An√°lise por Local de Vota√ß√£o (Escolas) -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-white mb-4">An√°lise Completa por Local de Vota√ß√£o</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="text-gray-400 uppercase tracking-wider">
                            <tr>
                                <th class="p-3">#</th>
                                <th class="p-3 sticky left-0 bg-gray-800">Local de Vota√ß√£o</th>
                                <th class="p-3">Bairro</th>
                                <th class="p-3 text-right">Seus Votos</th>
                                <th class="p-3 text-right">Penetra√ß√£o</th>
                                <th class="p-3 text-right">Eleitores Aptos</th>
                                <th class="p-3 text-right">Absten√ß√£o</th>
                                <th class="p-3 text-right">Brancos/Nulos</th>
                            </tr>
                        </thead>
                        <tbody id="locaisTable" class="divide-y divide-gray-700">
                            <!-- Linhas da tabela ser√£o inseridas aqui via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Mapa Estrat√©gico de Batalha -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-white">Mapa Estrat√©gico de Batalha</h2>
                    <p class="text-gray-400 mt-2">Visualize os territ√≥rios, sua influ√™ncia e as √°reas com maior potencial de votos.</p>
                </div>
                <div class="chart-container">
                    <canvas id="strategicMapChart"></canvas>
                </div>
                 <div class="flex justify-center flex-wrap gap-4 mt-4 text-xs text-gray-400">
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-gray-600"></span>
                        <span>Tamanho do Bairro = Total de Eleitores</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full bg-cyan-500"></span>
                        <span>Seu C√≠rculo de Influ√™ncia = Seus Votos</span>
                    </div>
                     <div class="flex items-center gap-2">
                        <span class="font-bold text-amber-400">Cor do Bairro</span>
                        <span>= Potencial de Votos (Absten√ß√µes + B/N)</span>
                    </div>
                </div>
            </div>

            <!-- Estrat√©gias 2024 -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-white mb-6 text-center">
                    <span class="text-cyan-400">Estrat√©gias Avan√ßadas</span> (Base 2024)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <details class="bg-gray-700 p-4 rounded-lg cursor-pointer">
                        <summary class="font-semibold text-lg text-white">1. Fortalecer a Base e Replicar o Sucesso</summary>
                        <p class="mt-3 text-gray-300">Seus locais de maior penetra√ß√£o (como a <strong>E.E.B. PROF. LOTHAR KRIECK</strong>) s√£o seus redutos. <strong>A√ß√£o:</strong> Entenda o perfil do eleitor desses locais e procure por bairros e locais de vota√ß√£o com caracter√≠sticas semelhantes para aplicar a mesma estrat√©gia de comunica√ß√£o que deu certo.</p>
                    </details>
                    <details class="bg-gray-700 p-4 rounded-lg cursor-pointer">
                        <summary class="font-semibold text-lg text-white">2. Expans√£o Inteligente (Onde h√° Potencial)</summary>
                        <p class="mt-3 text-gray-300">Bairros como <strong>Escola Agr√≠cola</strong> e <strong>Itoupava Seca</strong> mostram uma presen√ßa relevante. <strong>A√ß√£o:</strong> Foque seus recursos e agenda nesses bairros para transformar a presen√ßa em domin√¢ncia. O investimento de tempo e energia aqui pode ter o melhor retorno.</p>
                    </details>
                    <details class="bg-amber-900/50 p-4 rounded-lg cursor-pointer ring-1 ring-amber-500">
                        <summary class="font-semibold text-lg text-amber-300">3. Conquistar os Ausentes e Indecisos</summary>
                        <p class="mt-3 text-gray-300">O Mapa de Batalha destaca em √¢mbar os bairros com mais votos a serem conquistados. <strong>A√ß√£o:</strong> Crie uma campanha espec√≠fica para esses locais, com uma mensagem que dialogue com a insatisfa√ß√£o. Uma simples a√ß√£o de incentivo ao comparecimento pode trazer dezenas de novos votos.</p>
                    </details>
                    <details class="bg-red-900/50 p-4 rounded-lg cursor-pointer ring-1 ring-red-500">
                        <summary class="font-semibold text-lg text-red-300">4. Mapear e Neutralizar a Concorr√™ncia</summary>
                        <p class="mt-3 text-gray-300">No Mapa, passe o mouse sobre bairros chave como a <strong>Velha</strong> para ver que <strong>Jo√£o da Silva</strong> √© seu principal concorrente ali. <strong>A√ß√£o:</strong> Estude o perfil e a mensagem desses concorrentes diretos e elabore uma comunica√ß√£o que mostre seus diferenciais.</p>
                    </details>
                </div>
            </div>
        </div>

        <!-- Conte√∫do da Aba 2028: Ecossistema de Campanha -->
        <div id="content-2028" class="hidden">
            <div class="bg-gray-800 p-8 rounded-xl shadow-2xl">
                <header class="text-center mb-12">
                    <h2 class="text-4xl font-bold text-white">Ecossistema de Campanha 2028</h2>
                    <p class="mt-2 text-lg text-slate-400">Gerencie sua equipe, aloque recursos e conquiste Blumenau, bairro a bairro.</p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Painel de Controle e A√ß√µes -->
                    <div class="lg:col-span-1 bg-slate-900 p-6 rounded-lg space-y-6">
                        <div>
                            <h3 class="font-bold text-xl text-white mb-4">Placar da Campanha</h3>
                            <div class="bg-slate-800 p-4 rounded-lg text-center">
                                <p class="text-sm text-slate-400">Votos Projetados</p>
                                <p class="text-5xl font-bold"><span id="sim-current-votes">319</span> / <span class="text-cyan-400">3000</span></p>
                            </div>
                        </div>

                        <div>
                            <h3 class="font-bold text-xl text-white mb-4">Recursos Dispon√≠veis</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm font-bold"><span>üóìÔ∏è Tempo</span><span id="sim-time">1000 dias</span></div>
                                    <div class="w-full bg-slate-700 rounded-full h-2.5"><div id="sim-time-bar" class="bg-blue-500 h-2.5 rounded-full" style="width: 100%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm font-bold"><span>üí∞ Or√ßamento</span><span id="sim-budget">R$ 50.000</span></div>
                                    <div class="w-full bg-slate-700 rounded-full h-2.5"><div id="sim-budget-bar" class="bg-green-500 h-2.5 rounded-full" style="width: 100%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm font-bold"><span>üë• Equipe</span><span id="sim-team">0</span></div>
                                    <div class="w-full bg-slate-700 rounded-full h-2.5"><div id="sim-team-bar" class="bg-yellow-500 h-2.5 rounded-full" style="width: 0%"></div></div>
                                </div>
                            </div>
                        </div>

                        <div>
                             <h3 class="font-bold text-xl text-white mb-4">Arsenal de A√ß√µes</h3>
                             <div class="space-y-3">
                                 <select id="sim-action-select" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500"></select>
                                 <div id="sim-team-assignment" class="hidden space-y-2">
                                    <label class="text-sm font-bold text-white">Alocar Equipe (B√¥nus de Sinergia)</label>
                                    <select id="sim-team-select" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500"></select>
                                 </div>
                                 <button id="sim-execute-btn" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 px-4 rounded-lg transition disabled:opacity-50" disabled>Executar A√ß√£o</button>
                             </div>
                        </div>
                    </div>

                    <!-- Tabuleiro Estrat√©gico -->
                    <div class="lg:col-span-2 bg-slate-900 p-6 rounded-lg">
                        <h3 class="font-bold text-xl text-white mb-4">Tabuleiro Estrat√©gico: Blumenau</h3>
                        <div class="grid grid-cols-3 sm:grid-cols-4 gap-4" id="sim-map">
                            <!-- Bairros ser√£o inseridos aqui -->
                        </div>
                    </div>
                </div>

                <!-- M√≥dulo de Equipe -->
                <div class="mt-8 bg-slate-900 p-6 rounded-lg">
                    <h3 class="font-bold text-xl text-white mb-4">Gest√£o de Equipe e Rede de Apoio (CRM)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                         <input type="text" id="team-name-input" placeholder="Nome do Membro" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                         <input type="text" id="team-whatsapp-input" placeholder="WhatsApp (ex: 47999887766)" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                         <input type="text" id="team-instagram-input" placeholder="Instagram (ex: @usuario)" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                         <select id="team-bairro-select" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500"></select>
                         <select id="team-type-select" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            <option value="Volunt√°rio">Volunt√°rio</option>
                            <option value="Cabo Eleitoral">Cabo Eleitoral</option>
                            <option value="Lideran√ßa">Lideran√ßa</option>
                         </select>
                         <button id="add-team-member-btn" class="w-full bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg transition">Recrutar</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="text-gray-400 uppercase">
                                <tr><th class="p-2">Nome</th><th class="p-2">Tipo</th><th class="p-2">Bairro de Atua√ß√£o</th><th class="p-2">Contatos</th><th class="p-2">Rede</th><th class="p-2">A√ß√µes</th></tr>
                            </thead>
                            <tbody id="team-table-body" class="divide-y divide-gray-700"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- M√≥dulo Rede de Mobiliza√ß√£o (Pir√¢mide) -->
                <div class="mt-8 bg-slate-900 p-6 rounded-lg">
                    <h3 class="font-bold text-xl text-white mb-4">Rede de Mobiliza√ß√£o (Sua Pir√¢mide de Apoio)</h3>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <select id="leader-select" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500" title="Selecione um l√≠der da sua equipe"></select>
                        <input type="text" id="supporter-name-input" placeholder="Nome do novo apoiador" class="w-full bg-slate-700 rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <button id="add-supporter-btn" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg transition">Adicionar √† Rede</button>
                    </div>
                    <div id="pyramid-display" class="space-y-4 max-h-72 overflow-y-auto">
                        <!-- Pyramid will be rendered here -->
                    </div>
                </div>

            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DATA WAREHOUSE ---
    const electionData = [ { bairro: "√Ågua Verde", total: 57, locais: [{ nome: "E.B.M. PROF. OSCAR UNBEHAUN", secoes: [{n:691,v:1},{n:692,v:1},{n:693,v:1},{n:694,v:2},{n:695,v:2},{n:696,v:1},{n:701,v:1},{n:706,v:1}] },{ nome: "E.E.B. PROF. LOTHAR KRIECK", secoes: [{n:503,v:7},{n:504,v:7},{n:505,v:5},{n:506,v:2},{n:507,v:4},{n:508,v:3},{n:509,v:7},{n:510,v:8},{n:511,v:1},{n:743,v:3}] }]}, { bairro: "Badenfurt", total: 1, locais: [{ nome: "E.B.M. LAURO MULLER", secoes: [{n:138,v:1}] }]}, { bairro: "Centro", total: 7, locais: [{ nome: "ASSOC. FRANCISCANA DE ENSINO", secoes: [{n:17,v:1},{n:30,v:1},{n:32,v:1},{n:304,v:2},{n:373,v:1},{n:453,v:1}] }]}, { bairro: "Da Gloria", total: 3, locais: [{ nome: "E.E.B. GOV. CELSO RAMOS", secoes: [{n:81,v:1},{n:94,v:1},{n:370,v:1}] }]}, { bairro: "Escola Agr√≠cola", total: 46, locais: [{ nome: "CEDUPHH", secoes: [{n:644,v:2},{n:645,v:2},{n:647,v:1},{n:717,v:2},{n:722,v:1},{n:723,v:3},{n:727,v:1},{n:728,v:1},{n:729,v:2},{n:731,v:1},{n:733,v:4},{n:734,v:1},{n:739,v:2}] },{ nome: "E.B.M. GENERAL L√öCIO ESTEVES", secoes: [{n:587,v:1},{n:588,v:2},{n:589,v:2},{n:590,v:2},{n:591,v:1},{n:592,v:1},{n:593,v:1},{n:594,v:1},{n:595,v:2},{n:598,v:3},{n:600,v:1},{n:601,v:3},{n:602,v:1},{n:603,v:2}] }]}, { bairro: "Fortaleza", total: 3, locais: [{ nome: "E.E.B. PROF. HERIBERTO MULLER", secoes: [{n:41,v:1},{n:184,v:1},{n:240,v:1}] }]}, { bairro: "Garcia", total: 10, locais: [{ nome: "ASSOC. EDUC. SHALOM", secoes: [{n:418,v:2}] },{ nome: "E.B.M. ALICE THIELE", secoes: [{n:451,v:1}] },{ nome: "E.B.M. TIRADENTES", secoes: [{n:444,v:1}] },{ nome: "E.E.B. SANTOS DUMONT", secoes: [{n:56,v:1},{n:62,v:1},{n:395,v:1},{n:458,v:2},{n:462,v:1}] }]}, { bairro: "Itoupava Central", total: 12, locais: [{ nome: "E.B.M. ANITA GARIBALDI", secoes: [{n:201,v:1}] },{ nome: "E.B.M. DUQUE DE CAXIAS", secoes: [{n:296,v:1}] },{ nome: "E.B.M. PEDRO I", secoes: [{n:79,v:1},{n:82,v:1},{n:185,v:1},{n:237,v:1}] },{ nome: "E.B.M. VISCONDE DE TAUNAY", secoes: [{n:87,v:2},{n:189,v:1},{n:266,v:1},{n:275,v:1}] },{ nome: "E.B.M. WILHELM SCHURMANN", secoes: [{n:282,v:1}] }]}, { bairro: "Itoupava Norte", total: 7, locais: [{ nome: "E.B.M. PROF. ADELAIDE STARKE", secoes: [{n:150,v:1},{n:173,v:2},{n:234,v:1},{n:265,v:1},{n:274,v:1}] },{ nome: "E.E.B. PROF. JO√ÉO WIDEMANN", secoes: [{n:54,v:1}] }]}, { bairro: "Itoupava Seca", total: 16, locais: [{ nome: "E.B.M. MACHADO DE ASSIS", secoes: [{n:671,v:1},{n:673,v:1},{n:675,v:2},{n:677,v:2},{n:683,v:1}] },{ nome: "FURB", secoes: [{n:525,v:1},{n:555,v:1},{n:557,v:1},{n:560,v:4},{n:562,v:1},{n:569,v:1}] }]}, { bairro: "Nova Esperan√ßa", total: 1, locais: [{ nome: "E.B.M. GUSTAVO RICHARD", secoes: [{n:23,v:1}] }]}, { bairro: "Passo Manso", total: 7, locais: [{ nome: "E.E.B. CARLOS TECHENTIN", secoes: [{n:631,v:2},{n:633,v:1},{n:634,v:1},{n:638,v:1},{n:641,v:2}] }]}, { bairro: "Ponta Aguda", total: 3, locais: [{ nome: "E.B.M. ALM. TAMANDAR√â", secoes: [{n:7,v:1},{n:170,v:1}] },{ nome: "FACULDADE SENAC", secoes: [{n:12,v:1}] }]}, { bairro: "Progresso", total: 2, locais: [{ nome: "E.E.F. JOS√â VIEIRA C√îRTE", secoes: [{n:431,v:1},{n:472,v:1}] }]}, { bairro: "Salto do Norte", total: 3, locais: [{ nome: "E.B.M. LEOBERTO LEAL", secoes: [{n:113,v:1},{n:269,v:2}] }]}, { bairro: "Testo Salto", total: 3, locais: [{ nome: "E.B.M. PROF. JO√ÉO FRONZA", secoes: [{n:260,v:1},{n:281,v:1}] },{ nome: "E.B.M. QUINTINO BOCAI√öVA", secoes: [{n:128,v:1}] }]}, { bairro: "Tribess", total: 4, locais: [{ nome: "E.B.M. FRANCISCO LANSER", secoes: [{n:32,v:1},{n:220,v:2},{n:252,v:1}] }]}, { bairro: "Valparaiso", total: 3, locais: [{ nome: "E.E.B. PROF. IZOLETE M√úLLER", secoes: [{n:48,v:1},{n:387,v:1},{n:427,v:1}] }]}, { bairro: "Velha", total: 102, locais: [{ nome: "E.B.M. ALBERTO STEIN", secoes: [{n:648,v:9},{n:649,v:7},{n:650,v:2},{n:651,v:4},{n:652,v:7},{n:653,v:6},{n:654,v:2},{n:655,v:3},{n:656,v:4},{n:658,v:4},{n:659,v:2},{n:660,v:6},{n:661,v:3},{n:662,v:7},{n:663,v:3},{n:664,v:5},{n:665,v:5},{n:666,v:2},{n:667,v:3},{n:668,v:5},{n:669,v:2}] },{ nome: "E.E.B. ADOLPHO KONDER", secoes: [{n:496,v:1},{n:499,v:1},{n:501,v:4}] },{ nome: "PR√ì FAM√çLIA I", secoes: [{n:577,v:1},{n:578,v:1},{n:580,v:2},{n:581,v:1}] }]}, { bairro: "Velha Central", total: 13, locais: [{ nome: "E.B.M. PROF. ZULMA SOUZA", secoes: [{n:711,v:1},{n:713,v:1},{n:715,v:1}] },{ nome: "E.E.B. HERC√çLIO DEEKE", secoes: [{n:606,v:1},{n:607,v:1},{n:609,v:1},{n:615,v:1},{n:619,v:1},{n:627,v:1},{n:628,v:1}] },{ nome: "E.E.B. JO√ÉO DURVAL MULLER", secoes: [{n:533,v:2},{n:536,v:1}] }]}, { bairro: "Velha Grande", total: 1, locais: [{ nome: "E.B.M. CONSELHEIRO MAFRA", secoes: [{n:520,v:1}] }]}, { bairro: "Vila Nova", total: 15, locais: [{ nome: "E.E.B. VICTOR HERING", secoes: [{n:539,v:1},{n:540,v:1},{n:541,v:1},{n:542,v:1},{n:543,v:2},{n:544,v:1},{n:546,v:2},{n:547,v:2},{n:548,v:2},{n:549,v:2}] }]} ];
    const sectionTotalsData = { 691:{aptos:350, comparecimento:298, brancosNulos:15}, 692:{aptos:350, comparecimento:297, brancosNulos:12}, 693:{aptos:350, comparecimento:319, brancosNulos:20}, 694:{aptos:350, comparecimento:320, brancosNulos:18}, 695:{aptos:350, comparecimento:318, brancosNulos:22}, 696:{aptos:350, comparecimento:310, brancosNulos:14}, 701:{aptos:350, comparecimento:312, brancosNulos:11}, 706:{aptos:350, comparecimento:316, brancosNulos:19}, 503:{aptos:345, comparecimento:291, brancosNulos:25}, 504:{aptos:345, comparecimento:291, brancosNulos:21}, 505:{aptos:345, comparecimento:290, brancosNulos:30}, 506:{aptos:345, comparecimento:290, brancosNulos:28}, 507:{aptos:345, comparecimento:291, brancosNulos:17}, 508:{aptos:345, comparecimento:292, brancosNulos:15}, 509:{aptos:345, comparecimento:292, brancosNulos:23}, 510:{aptos:345, comparecimento:292, brancosNulos:22}, 511:{aptos:345, comparecimento:290, brancosNulos:14}, 743:{aptos:345, comparecimento:294, brancosNulos:18}, 138:{aptos:360, comparecimento:319, brancosNulos:31}, 648:{aptos:360, comparecimento:312, brancosNulos:29}, 649:{aptos:360, comparecimento:312, brancosNulos:35}, 650:{aptos:360, comparecimento:313, brancosNulos:31}, 651:{aptos:360, comparecimento:313, brancosNulos:28}, 652:{aptos:360, comparecimento:313, brancosNulos:33}, 653:{aptos:360, comparecimento:313, brancosNulos:25}, 654:{aptos:360, comparecimento:314, brancosNulos:27}, 655:{aptos:360, comparecimento:314, brancosNulos:21}, 656:{aptos:360, comparecimento:314, brancosNulos:29}, 658:{aptos:360, comparecimento:314, brancosNulos:30}, 659:{aptos:360, comparecimento:314, brancosNulos:19}, 660:{aptos:360, comparecimento:314, brancosNulos:24}, 661:{aptos:360, comparecimento:315, brancosNulos:28}, 662:{aptos:360, comparecimento:315, brancosNulos:32}, 663:{aptos:360, comparecimento:315, brancosNulos:18}, 664:{aptos:360, comparecimento:315, brancosNulos:26}, 665:{aptos:360, comparecimento:315, brancosNulos:22}, 666:{aptos:360, comparecimento:315, brancosNulos:19}, 667:{aptos:360, comparecimento:316, brancosNulos:27}, 668:{aptos:360, comparecimento:316, brancosNulos:23}, 669:{aptos:360, comparecimento:316, brancosNulos:25}, 587:{aptos:355, comparecimento:318, brancosNulos:20}, 588:{aptos:355, comparecimento:318, brancosNulos:24}, 589:{aptos:355, comparecimento:318, brancosNulos:18}, 590:{aptos:355, comparecimento:318, brancosNulos:21}, 591:{aptos:355, comparecimento:318, brancosNulos:15}, 592:{aptos:355, comparecimento:319, brancosNulos:17}, 593:{aptos:355, comparecimento:319, brancosNulos:23}, 594:{aptos:355, comparecimento:319, brancosNulos:19}, 595:{aptos:355, comparecimento:319, brancosNulos:25}, 598:{aptos:355, comparecimento:319, brancosNulos:22}, 600:{aptos:355, comparecimento:319, brancosNulos:16}, 601:{aptos:355, comparecimento:318, brancosNulos:28}, 602:{aptos:355, comparecimento:318, brancosNulos:14}, 603:{aptos:355, comparecimento:318, brancosNulos:20} };
    const competitorData = { "Velha": {"Gabriel Gabe": 102, "Jo√£o da Silva": 155, "Maria Santos": 120, "Carlos Pereira": 95, "Ana Oliveira": 80}, "√Ågua Verde": {"Gabriel Gabe": 57, "Jo√£o da Silva": 80, "Maria Santos": 65, "Carlos Pereira": 50, "Ana Oliveira": 40}, "Escola Agr√≠cola": {"Gabriel Gabe": 46, "Jo√£o da Silva": 90, "Maria Santos": 75, "Carlos Pereira": 60, "Ana Oliveira": 55} };
    const allBairros = [...new Set(electionData.map(d => d.bairro))].sort();

    // --- DATA PROCESSING (Shared) ---
    const locationsData = {};
    const bairroData = {};
    electionData.forEach(bairro => {
        if(!bairroData[bairro.bairro]) { bairroData[bairro.bairro] = { nome: bairro.bairro, totalVotos: 0, totalComparecimento: 0, totalAptos: 0, totalBrancosNulos: 0, totalAbstention: 0, }; }
        bairroData[bairro.bairro].totalVotos += bairro.total;
        bairro.locais.forEach(local => {
            const localKey = `${local.nome.replace(/\s+/g, '-')}-${bairro.bairro.replace(/\s+/g, '-')}`;
            if (!locationsData[localKey]) { locationsData[localKey] = { nome: local.nome, bairro: bairro.bairro, secoes: [], totalVotos: 0, totalComparecimento: 0, totalAptos: 0, totalBrancosNulos: 0 }; }
            local.secoes.forEach(secao => {
                const sectionData = sectionTotalsData[secao.n] || {aptos: 350, comparecimento: 300, brancosNulos: 20};
                const secaoCompleta = { n: secao.n, v: secao.v, comparecimento: sectionData.comparecimento, penetration: (sectionData.comparecimento > 0) ? (secao.v / sectionData.comparecimento) * 100 : 0 };
                locationsData[localKey].secoes.push(secaoCompleta);
                locationsData[localKey].totalVotos += secao.v;
                locationsData[localKey].totalComparecimento += sectionData.comparecimento;
                locationsData[localKey].totalAptos += sectionData.aptos;
                locationsData[localKey].totalBrancosNulos += sectionData.brancosNulos;
                bairroData[bairro.bairro].totalComparecimento += sectionData.comparecimento;
                bairroData[bairro.bairro].totalAptos += sectionData.aptos;
                bairroData[bairro.bairro].totalBrancosNulos += sectionData.brancosNulos;
            });
        });
    });
    Object.values(bairroData).forEach(b => {
        b.totalAbstention = b.totalAptos - b.totalComparecimento;
        b.opportunity = b.totalAbstention + b.totalBrancosNulos;
        b.penetration = (b.totalComparecimento > 0) ? (b.totalVotos / b.totalComparecimento) * 100 : 0;
    });
    Object.values(locationsData).forEach(local => {
        local.penetration = (local.totalComparecimento > 0) ? (local.totalVotos / local.totalComparecimento) * 100 : 0;
        local.abstentionCount = local.totalAptos - local.totalComparecimento;
        local.abstentionPerc = (local.totalAptos > 0) ? (local.abstentionCount / local.totalAptos) * 100 : 0;
        local.brancosNulosPerc = (local.totalComparecimento > 0) ? (local.totalBrancosNulos / local.totalComparecimento) * 100 : 0;
    });

    // --- TAB 2024 LOGIC ---
    const initTab2024 = () => {
        const totalVotes = electionData.reduce((acc, curr) => acc + curr.total, 0);
        const sortedLocationsByVotes = Object.values(locationsData).sort((a, b) => b.totalVotos - a.totalVotos);
        const sortedLocationsByPenetration = Object.values(locationsData).sort((a, b) => b.penetration - a.penetration);
        const sortedLocationsByAbstention = Object.values(locationsData).sort((a, b) => b.abstentionCount - a.abstentionCount);
        
        document.getElementById('totalVotes').textContent = totalVotes;
        document.getElementById('totalLocations').textContent = Object.keys(locationsData).length;
        const strongestLocation = sortedLocationsByVotes[0];
        document.getElementById('strongestLocationName').textContent = strongestLocation.nome;
        document.getElementById('strongestLocationVotes').textContent = `${strongestLocation.totalVotos} votos`;
        const highestPenetration = sortedLocationsByPenetration[0];
        document.getElementById('highestPenetrationLocation').textContent = highestPenetration.nome;
        document.getElementById('highestPenetrationValue').textContent = `${highestPenetration.penetration.toFixed(2)}%`;
        const highestAbstention = sortedLocationsByAbstention[0];
        document.getElementById('highestAbstentionLocation').textContent = highestAbstention.nome;
        document.getElementById('highestAbstentionValue').textContent = `${highestAbstention.abstentionCount} absten√ß√µes`;

        const locaisTableBody = document.getElementById('locaisTable');
        locaisTableBody.innerHTML = ''; 
        sortedLocationsByVotes.forEach((local, index) => {
            const localKey = `${local.nome.replace(/\s+/g, '-')}-${local.bairro.replace(/\s+/g, '-')}`;
            locaisTableBody.innerHTML += `
                <tr class="location-row hover:bg-gray-700/50" data-location-key="${localKey}">
                    <td class="p-3">${index + 1}</td>
                    <td class="p-3 font-semibold sticky left-0 bg-gray-800">${local.nome}</td>
                    <td class="p-3">${local.bairro}</td>
                    <td class="p-3 text-right font-bold text-lg text-cyan-400">${local.totalVotos}</td>
                    <td class="p-3 text-right font-bold ${local.penetration > 1.5 ? 'text-teal-400' : 'text-gray-300'}">${local.penetration.toFixed(2)}%</td>
                    <td class="p-3 text-right text-gray-400">${local.totalAptos}</td>
                    <td class="p-3 text-right ${local.abstentionPerc > 15 ? 'text-amber-400' : 'text-gray-300'}">${local.abstentionPerc.toFixed(1)}% (${local.abstentionCount})</td>
                    <td class="p-3 text-right ${local.brancosNulosPerc > 8 ? 'text-amber-400' : 'text-gray-300'}">${local.brancosNulosPerc.toFixed(1)}% (${local.totalBrancosNulos})</td>
                </tr>
                <tr class="hidden details-row" data-details-for="${localKey}"><td colspan="8" class="p-0"><div class="details-container bg-gray-700/50 p-4"></div></td></tr>`;
        });

        locaisTableBody.addEventListener('click', (e) => {
            const row = e.target.closest('tr.location-row');
            if (!row) return;
            const locationKey = row.dataset.locationKey;
            const detailsRow = document.querySelector(`tr[data-details-for="${locationKey}"]`);
            if (detailsRow) {
                detailsRow.classList.toggle('hidden');
                const detailsContainer = detailsRow.querySelector('.details-container');
                if (!detailsContainer.hasChildNodes() && !detailsRow.classList.contains('hidden')) {
                    const locationData = locationsData[locationKey];
                    let detailsHtml = `<h4 class="text-md font-semibold mb-2 text-white">Detalhes das Se√ß√µes</h4><table class="w-full text-xs"><thead class="text-gray-400 uppercase"><tr><th class="p-2 text-left">Se√ß√£o</th><th class="p-2 text-right">Seus Votos</th><th class="p-2 text-right">Total Votantes</th><th class="p-2 text-right">Penetra√ß√£o</th></tr></thead><tbody class="divide-y divide-gray-600">`;
                    locationData.secoes.sort((a,b) => b.v - a.v).forEach(sec => {
                        detailsHtml += `<tr class="hover:bg-gray-600/50"><td class="p-2 text-left">${sec.n}</td><td class="p-2 text-right font-bold text-cyan-400">${sec.v}</td><td class="p-2 text-right text-gray-300">${sec.comparecimento}</td><td class="p-2 text-right font-bold ${sec.penetration > 2 ? 'text-teal-400' : 'text-gray-300'}">${sec.penetration.toFixed(2)}%</td></tr>`;
                    });
                    detailsHtml += `</tbody></table>`;
                    detailsContainer.innerHTML = detailsHtml;
                }
            }
        });

        const drawStrategicMap = () => {
            const ctx = document.getElementById('strategicMapChart').getContext('2d');
            const mapData = Object.values(bairroData);
            const maxAptos = Math.max(...mapData.map(b => b.totalAptos));
            const maxOpportunity = Math.max(...mapData.map(b => b.opportunity));
            const getCompetitorInfo = (bairro) => {
                const data = competitorData[bairro.nome];
                if (!data) return 'N/A';
                let mainCompetitor = '', maxVotes = -1;
                for (const [key, value] of Object.entries(data)) {
                    if (key !== 'Gabriel Gabe' && value > maxVotes) { maxVotes = value; mainCompetitor = key; }
                }
                return `${mainCompetitor} (${maxVotes} votos)`;
            };
            
            const datasets = [];
            const positions = {}; // Store positions to sync bubbles
            mapData.forEach(b => {
                positions[b.nome] = { x: Math.random() * 100, y: Math.random() * 100 };
                datasets.push({
                    label: b.nome,
                    data: [{ ...positions[b.nome], r: (b.totalAptos / maxAptos) * 50 + 10 }],
                    backgroundColor: `rgba(251, 191, 36, ${Math.max(b.opportunity / maxOpportunity, 0.2)})`,
                    borderColor: '#fcd34d', borderWidth: 2,
                });
            });
            mapData.forEach(b => {
                datasets.push({
                    label: `Votos ${b.nome}`,
                    data: [{ ...positions[b.nome], r: (b.totalVotos / maxAptos) * 50 + 4 }],
                    backgroundColor: 'rgba(34, 211, 238, 0.9)', borderColor: '#22d3ee',
                });
            });

            new Chart(ctx, {
                type: 'bubble', data: { datasets },
                options: { responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false },
                        tooltip: { enabled: true,
                            callbacks: {
                                label: function(context) {
                                    const bairroName = context.dataset.label.replace('Votos ', '');
                                    const data = bairroData[bairroName];
                                    if(!data) return '';
                                    return [ `Bairro: ${data.nome}`, `Seus Votos: ${data.totalVotos} (${data.penetration.toFixed(2)}%)`, `Eleitores Aptos: ${data.totalAptos}`, `Oportunidade (Ausentes+B/N): ${data.opportunity} votos`, `Principal Concorrente: ${getCompetitorInfo(data)}` ];
                                }
                            }
                        }
                    },
                    scales: { x: { display: false }, y: { display: false } },
                    layout: { padding: 20 }
                }
            });
        };
        drawStrategicMap();
    };

    // --- TAB 2028 LOGIC ---
    const initTab2028 = () => {
        let simState = JSON.parse(localStorage.getItem('simState_gg_eco')) || {
            resources: { time: 1000, budget: 50000 },
            team: [],
            bairros: {},
            selectedBairro: null
        };
        
        const initialResources = { time: 1000, budget: 50000 };
        const maxTeamSize = 20;

        const actions = {
            caminhada: { name: "Caminhada no Bairro", cost: { time: 2, budget: 50}, effect: { votes: 0.02, influence: 2}, synergyBonus: 2.0 },
            online: { name: "Campanha Online", cost: { time: 1, budget: 500}, effect: { votes: 0.05, influence: 1}, synergyBonus: 1.5 },
            liderancas: { name: "Reuni√£o com Lideran√ßas", cost: { time: 3, budget: 100}, effect: { votes: 0.01, influence: 5}, synergyBonus: 3.0 }
        };

        const profiles = {
            'Velha': { type: 'Fortaleza', potential: 5000 }, '√Ågua Verde': { type: 'Fortaleza', potential: 4000 },
            'Escola Agr√≠cola': { type: 'Crescimento', potential: 6000 }, 'Itoupava Seca': { type: 'Crescimento', potential: 5500 },
            'Garcia': { type: 'Batalha', potential: 7000 }, 'Centro': { type: 'Oportunidade', potential: 8000 }
        };

        if (Object.keys(simState.bairros).length === 0) {
            allBairros.forEach(b => {
                 const profile = profiles[b] || { type: 'Oportunidade', potential: 3000 };
                 simState.bairros[b] = { votes: bairroData[b]?.totalVotos || 0, influence: (bairroData[b]?.penetration || 0.1) * 10, potential: profile.potential, type: profile.type };
            });
        }
        
        const simCurrentVotes = document.getElementById('sim-current-votes');
        const simTime = document.getElementById('sim-time');
        const simTimeBar = document.getElementById('sim-time-bar');
        const simBudget = document.getElementById('sim-budget');
        const simBudgetBar = document.getElementById('sim-budget-bar');
        const simTeam = document.getElementById('sim-team');
        const simTeamBar = document.getElementById('sim-team-bar');
        const simActionSelect = document.getElementById('sim-action-select');
        const simTeamAssignment = document.getElementById('sim-team-assignment');
        const simTeamSelect = document.getElementById('sim-team-select');
        const simExecuteBtn = document.getElementById('sim-execute-btn');
        const simMap = document.getElementById('sim-map');
        const teamTableBody = document.getElementById('team-table-body');
        const leaderSelect = document.getElementById('leader-select');
        const supporterNameInput = document.getElementById('supporter-name-input');
        const addSupporterBtn = document.getElementById('add-supporter-btn');
        const pyramidDisplay = document.getElementById('pyramid-display');


        const updateUI = () => {
            simTime.textContent = `${simState.resources.time} dias`;
            simTimeBar.style.width = `${(simState.resources.time / initialResources.time) * 100}%`;
            simBudget.textContent = `R$ ${simState.resources.budget.toLocaleString('pt-BR')}`;
            simBudgetBar.style.width = `${(simState.resources.budget / initialResources.budget) * 100}%`;
            simTeam.textContent = `${simState.team.length}/${maxTeamSize}`;
            simTeamBar.style.width = `${(simState.team.length / maxTeamSize) * 100}%`;
            
            const totalVotes = Object.values(simState.bairros).reduce((sum, b) => sum + Math.round(b.votes), 0);
            simCurrentVotes.textContent = totalVotes;
            
            Object.entries(simState.bairros).forEach(([name, data]) => {
                const bairroEl = document.querySelector(`[data-bairro-name="${name}"]`);
                if (bairroEl) {
                    const influenceColor = Math.min(255, 50 + data.influence);
                    bairroEl.style.backgroundColor = `rgb(30, 41, ${influenceColor})`;
                    bairroEl.querySelector('.bairro-votes').textContent = Math.round(data.votes);
                    const teamCount = simState.team.filter(t => t.bairro === name).length;
                    bairroEl.querySelector('.team-count').textContent = teamCount > 0 ? `üë•${teamCount}`: '';
                }
            });
            renderTeamTable();
            renderPyramid();
        };

        const executeAction = () => {
            const actionKey = simActionSelect.value;
            const action = actions[actionKey];
            const bairroName = simState.selectedBairro;
            const bairro = simState.bairros[bairroName];
            const selectedTeamMemberId = parseInt(simTeamSelect.value);

            if (!action || !bairro || simState.resources.time < action.cost.time || simState.resources.budget < action.cost.budget) return;

            simState.resources.time -= action.cost.time;
            simState.resources.budget -= action.cost.budget;

            let voteGain = bairro.potential * action.effect.votes * (bairro.influence / 100);
            let influenceGain = action.effect.influence;
            
            const isTeamBonus = selectedTeamMemberId > 0 && simState.team.find(t => t.id === selectedTeamMemberId)?.bairro === bairroName;
            if (isTeamBonus) {
                voteGain *= action.synergyBonus;
                influenceGain *= action.synergyBonus;
            }

            bairro.votes += voteGain;
            bairro.influence += influenceGain;

            localStorage.setItem('simState_gg_eco', JSON.stringify(simState));
            updateUI();
        };

        const renderTeamTable = () => {
            if(simState.team.length === 0) {
                teamTableBody.innerHTML = `<tr><td colspan="6" class="p-4 text-center text-slate-400">Nenhum membro na equipe.</td></tr>`;
                return;
            }
            teamTableBody.innerHTML = simState.team.map(member => {
                const whatsappLink = member.whatsapp ? `<a href="https://wa.me/55${member.whatsapp.replace(/\D/g, '')}" target="_blank" class="text-green-400 hover:underline">WhatsApp</a>` : '';
                const instagramLink = member.instagram ? `<a href="https://instagram.com/${member.instagram.replace('@', '')}" target="_blank" class="text-pink-400 hover:underline">Instagram</a>` : '';
                const networkSize = member.network ? member.network.length : 0;

                return `
                <tr class="hover:bg-gray-700/50">
                    <td class="p-2 font-bold">${member.name}</td>
                    <td class="p-2">${member.type}</td>
                    <td class="p-2">${member.bairro}</td>
                    <td class="p-2 flex gap-x-3">${whatsappLink} ${instagramLink}</td>
                    <td class="p-2 text-center">${networkSize}</td>
                    <td class="p-2"><button class="delete-team-member-btn text-red-500 text-xs" data-id="${member.id}">Dispensar</button></td>
                </tr>
            `}).join('');
        };
        
        const renderPyramid = () => {
             const leaders = simState.team.filter(m => m.type === 'Lideran√ßa' || m.type === 'Cabo Eleitoral');
             leaderSelect.innerHTML = leaders.map(l => `<option value="${l.id}">${l.name} (${l.type})</option>`).join('');

             if(leaders.length === 0) {
                pyramidDisplay.innerHTML = '<p class="text-slate-400 text-center">Recrute Lideran√ßas ou Cabos Eleitorais para come√ßar a construir sua rede.</p>';
                return;
             }

             pyramidDisplay.innerHTML = leaders.filter(l => l.network && l.network.length > 0).map(leader => `
                <div class="bg-slate-800 p-4 rounded-lg">
                    <h5 class="font-bold text-cyan-400">${leader.name} <span class="text-xs text-gray-400 font-normal">- ${leader.bairro}</span></h5>
                    <div class="mt-2 pl-4 border-l-2 border-slate-700">
                        ${leader.network.map(supporter => `<p class="text-sm text-slate-300">${supporter}</p>`).join('')}
                    </div>
                </div>
             `).join('');

             if(pyramidDisplay.innerHTML === '') {
                 pyramidDisplay.innerHTML = '<p class="text-slate-400 text-center">Nenhum apoiador na rede. Adicione novos membros √† rede de seus l√≠deres.</p>';
             }
        };

        addSupporterBtn.addEventListener('click', () => {
            const leaderId = parseInt(leaderSelect.value);
            const supporterName = supporterNameInput.value;
            if(leaderId && supporterName.trim()) {
                const leader = simState.team.find(t => t.id === leaderId);
                if(leader) {
                    if (!leader.network) leader.network = [];
                    leader.network.push(supporterName);
                    supporterNameInput.value = '';
                    localStorage.setItem('simState_gg_eco', JSON.stringify(simState));
                    updateUI();
                }
            }
        });
        
        // Setup Actions
        simActionSelect.innerHTML = Object.entries(actions).map(([key, action]) => `<option value="${key}">${action.name}</option>`).join('');
        simExecuteBtn.addEventListener('click', executeAction);

        // Setup Map
        simMap.innerHTML = allBairros.map(bairroName => `
            <div class="bairro-map-item bg-slate-800 p-2 rounded-lg text-center border-2 border-transparent relative" data-bairro-name="${bairroName}">
                <p class="text-xs font-bold truncate">${bairroName}</p>
                <p class="text-lg font-bold bairro-votes">0</p>
                <p class="absolute top-1 right-1 text-xs text-yellow-300 team-count"></p>
            </div>
        `).join('');
        simMap.addEventListener('click', (e) => {
            const bairroEl = e.target.closest('.bairro-map-item');
            if (bairroEl) {
                simState.selectedBairro = bairroEl.dataset.bairroName;
                document.querySelectorAll('.bairro-map-item').forEach(el => el.classList.remove('selected'));
                bairroEl.classList.add('selected');
                simExecuteBtn.disabled = false;
                
                simTeamAssignment.classList.remove('hidden');
                const localTeam = simState.team.filter(t => t.bairro === simState.selectedBairro);
                simTeamSelect.innerHTML = '<option value="0">Ningu√©m (sem b√¥nus)</option>' + localTeam.map(t => `<option value="${t.id}">${t.name} (${t.type})</option>`).join('');
            }
        });

        // Setup Team Management
        const teamNameInput = document.getElementById('team-name-input');
        const teamWhatsappInput = document.getElementById('team-whatsapp-input');
        const teamInstagramInput = document.getElementById('team-instagram-input');
        const teamBairroSelect = document.getElementById('team-bairro-select');
        teamBairroSelect.innerHTML = allBairros.map(b => `<option value="${b}">${b}</option>`).join('');
        const teamTypeSelect = document.getElementById('team-type-select');
        const addTeamMemberBtn = document.getElementById('add-team-member-btn');
        
        addTeamMemberBtn.addEventListener('click', () => {
            const name = teamNameInput.value;
            if (name.trim() && simState.team.length < maxTeamSize && simState.resources.time >= 5) {
                simState.team.push({ 
                    id: Date.now(), 
                    name: name, 
                    bairro: teamBairroSelect.value, 
                    type: teamTypeSelect.value,
                    whatsapp: teamWhatsappInput.value,
                    instagram: teamInstagramInput.value,
                    network: []
                });
                simState.resources.time -= 5; // Cost to recruit
                teamNameInput.value = '';
                teamWhatsappInput.value = '';
                teamInstagramInput.value = '';
                localStorage.setItem('simState_gg_eco', JSON.stringify(simState));
                updateUI();
            }
        });

        document.getElementById('team-table-body').addEventListener('click', (e) => {
            if(e.target.classList.contains('delete-team-member-btn')) {
                const memberId = parseInt(e.target.dataset.id);
                simState.team = simState.team.filter(t => t.id !== memberId);
                localStorage.setItem('simState_gg_eco', JSON.stringify(simState));
                updateUI();
            }
        });
        
        updateUI();
    };


    // --- TAB CONTROL ---
    const tab2024 = document.getElementById('tab-2024');
    const tab2028 = document.getElementById('tab-2028');
    const content2024 = document.getElementById('content-2024');
    const content2028 = document.getElementById('content-2028');
    let is2028Initialized = false;

    tab2024.addEventListener('click', () => {
        tab2024.classList.add('active', 'text-cyan-400');
        tab2024.classList.remove('text-gray-400', 'hover:text-cyan-400');
        tab2028.classList.remove('active', 'text-cyan-400');
        tab2028.classList.add('text-gray-400', 'hover:text-cyan-400');
        content2024.classList.remove('hidden');
        content2028.classList.add('hidden');
    });

    tab2028.addEventListener('click', () => {
        tab2028.classList.add('active', 'text-cyan-400');
        tab2028.classList.remove('text-gray-400', 'hover:text-cyan-400');
        tab2024.classList.remove('active', 'text-cyan-400');
        tab2024.classList.add('text-gray-400', 'hover:text-cyan-400');
        content2028.classList.remove('hidden');
        content2024.classList.add('hidden');
        if (!is2028Initialized) {
            initTab2028();
            is2028Initialized = true;
        }
    });

    // Initial load
    initTab2024();
});
</script>
</body>
</html>

