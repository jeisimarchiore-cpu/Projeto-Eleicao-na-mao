<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala de Guerra Eleitoral v8.6 - Análise com Mapa</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
    <script>
        // Tailwind CSS configuration for a new professional color scheme.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'playfair': ['"Playfair Display"', 'serif']
                    },
                    colors: {
                        'primary': '#8b5cf6', // violet-500
                        'secondary': '#14b8a6', // teal-500
                        'background': '#111827', // gray-900
                        'card': '#1f2937', // gray-800
                        'text-main': '#f9fafb', // gray-50
                        'text-light': '#d1d5db', // gray-300
                        'text-neutral': '#9ca3af', // gray-400
                        'border': '#374151', // gray-700
                        'success': '#10b981', // emerald-500
                        'danger': '#dc2626', // red-600
                        'warning': '#f59e0b', // amber-500
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for a polished 'war room' feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: tailwind.config.theme.extend.colors.background;
            color: tailwind.config.theme.extend.colors['text-main'];
        }
        input, select {
            color: #ffffff;
        }
        input::placeholder {
            color: #9ca3af; /* gray-400 */
        }
        .party-bar {
            transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .risk-card {
            transition: all 0.3s ease-in-out;
            border-left-width: 4px;
        }
        .clickable { cursor: pointer; transition: background-color 0.2s; }
        .clickable:hover { background-color: #374151; }
        
        /* Modal Styles */
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px;}
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* Alliance Checkbox */
        .alliance-checkbox:checked + label {
            background-color: #8b5cf6;
            border-color: #8b5cf6;
            color: white;
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .tab-button.active {
            border-bottom-color: #8b5cf6;
            color: #f9fafb;
        }
        
        /* Map Styles */
        #map-container {
            position: relative;
            background-color: #1f2937;
            border-radius: 0.5rem;
            border: 1px solid #374151;
        }
        .municipio {
            stroke: #4b5563;
            stroke-width: 0.5px;
            transition: fill 0.3s ease, stroke 0.3s ease;
        }
        .municipio.highlight {
            stroke: #f9fafb;
            stroke-width: 1.5px;
        }
        #map-tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            background: #111827;
            border: 1px solid #374151;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            color: #f9fafb;
        }

        /* Ensure all text is white */
        .text-text-main, .text-text-light, .text-text-neutral, .font-bold, p, h1, h2, h3, h4, h5, h6, span, div, th, td { 
            color: #f9fafb; 
        }
        .text-primary { color: #8b5cf6 !important; }
        .text-secondary { color: #14b8a6 !important; }
        .text-success { color: #10b981 !important; }
        .text-danger { color: #dc2626 !important; }
        .text-warning { color: #f59e0b !important; }
        .text-blue-400 { color: #60a5fa !important; }
        .text-pink-400 { color: #f472b6 !important; }


        /* Print Styles */
        @media print {
            body { 
                background-color: #111827 !important; 
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            header, aside, .no-print, #map-container { 
                display: none !important; 
            }
            main, div, section { 
                display: block !important; 
                width: 100% !important; 
                padding: 0 !important; 
                margin: 0 !important; 
            }
            .bg-card { 
                background-color: #1f2937 !important; 
                border: 1px solid #374151 !important; 
                page-break-inside: avoid;
            }
            * {
                color: #f9fafb !important;
            }
            .text-primary { color: #8b5cf6 !important; }
            .text-secondary { color: #14b8a6 !important; }
            .text-success { color: #10b981 !important; }
            .text-danger { color: #dc2626 !important; }
            .text-warning { color: #f59e0b !important; }
            .text-blue-400 { color: #60a5fa !important; }
            .text-pink-400 { color: #f472b6 !important; }
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen">
        <!-- Header Section -->
        <header class="bg-card/50 backdrop-blur-sm sticky top-0 z-20 border-b border-border">
            <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-3 relative flex justify-center items-center">
                 <div id="logo-container" class="absolute left-4 top-1/2 -translate-y-1/2 flex flex-col items-center w-28">
                    <div class="w-16 h-16 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-lg">
                        <span class="font-playfair font-bold text-3xl text-white">SM</span>
                    </div>
                    <p class="font-playfair font-bold text-sm text-text-main mt-2 text-center">Silmara Miguel</p>
                </div>
                <div class="text-center">
                    <h1 class="text-2xl font-bold text-text-main">
                        <i class="fa-solid fa-chess-rook text-primary mr-2" title="Sala de Guerra Eleitoral"></i>Sala de Guerra Eleitoral <span class="text-primary text-sm font-mono">v8.6</span>
                    </h1>
                    <p class="text-text-light text-sm">Análise e Simulação de Cenários Eleitorais - SC 2026</p>
                </div>
            </div>
            <!-- Main Navigation Tabs -->
            <nav class="max-w-screen-2xl mx-auto flex justify-center items-center space-x-4 sm:space-x-8" id="main-tabs">
                <button class="tab-button active font-semibold py-3 px-2 sm:px-4" onclick="changeTab('simulador')"><i class="fa-solid fa-sliders mr-2"></i>Simulador de Cenário</button>
                <button class="tab-button font-semibold py-3 px-2 sm:px-4 text-text-light" onclick="changeTab('candidatos')"><i class="fa-solid fa-users mr-2"></i>Base de Candidatos</button>
                <button class="tab-button font-semibold py-3 px-2 sm:px-4 text-text-light" onclick="changeTab('editarLegenda')"><i class="fa-solid fa-user-pen mr-2"></i>Editar Legenda</button>
                <button class="tab-button font-semibold py-3 px-2 sm:px-4 text-text-light" onclick="changeTab('analise')"><i class="fa-solid fa-brain mr-2"></i>Análise Estratégica</button>
                <button class="tab-button font-semibold py-3 px-2 sm:px-4 text-text-light" onclick="changeTab('eleitos2024')"><i class="fa-solid fa-map-location-dot mr-2"></i>Regiões CIADESCP</button>
            </nav>
        </header>

        <main class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
            <!-- TAB: SIMULATOR -->
            <div id="content-simulador">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <!-- Control Panel Sidebar -->
                    <aside class="lg:col-span-1 space-y-6 no-print">
                        <!-- CURRENT SCENARIO SUMMARY -->
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-chart-pie mr-2"></i>Cenário Atual</h2>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Votos Válidos</p>
                                    <p id="summary-vv" class="text-xl font-bold text-success">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Quociente</p>
                                    <p id="summary-qe" class="text-xl font-bold text-primary">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Votos Brancos</p>
                                    <p id="summary-vb" class="text-xl font-bold text-text-neutral">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Votos Nulos</p>
                                    <p id="summary-vn" class="text-xl font-bold text-text-neutral">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Nota Corte</p>
                                    <p id="summary-nc" class="text-xl font-bold text-warning">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Em Risco</p>
                                    <p id="summary-vr" class="text-xl font-bold text-danger">0</p>
                                </div>
                                <div class="bg-background p-3 rounded-lg text-center col-span-2">
                                    <p class="text-xs font-semibold text-text-light uppercase truncate">Total de Cadeiras</p>
                                    <p id="summary-cadeiras" class="text-xl font-bold text-secondary">0</p>
                                </div>
                            </div>
                            <div class="flex justify-center items-center bg-background rounded-lg p-1 mt-4">
                                <button id="btn-cenario-base" onclick="viewBaseSummary()" class="w-full py-1 text-sm rounded-md">Base 2022</button>
                                <button id="btn-cenario-projetado" onclick="viewProjectedSummary()" class="w-full py-1 text-sm rounded-md bg-primary text-white">Projetado 2026</button>
                            </div>
                        </div>

                        <!-- SCENARIO CONTROLS -->
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-sliders mr-2"></i>Painel de Controle do Cenário</h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="abstention-rate" class="block text-sm font-medium text-text-light mb-1">Taxa de Abstenção</label>
                                    <input type="range" id="abstention-rate" min="15" max="30" value="18.6" step="0.1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updateScenario()">
                                    <div class="flex justify-between items-center mt-1">
                                        <span class="text-xs text-text-light">Base 2022: <span id="base-abstention-display" class="font-mono"></span>%</span>
                                        <span class="text-sm font-mono text-primary"><span id="abstention-value">18.6</span>%</span>
                                    </div>
                                </div>
                                <div>
                                    <label for="electorate-growth" class="block text-sm font-medium text-text-light mb-1">Crescimento do Eleitorado</label>
                                    <input type="range" id="electorate-growth" min="-10" max="10" value="0" step="0.1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updateScenario()">
                                     <div class="flex justify-between items-center mt-1">
                                        <span class="text-xs text-text-light">Base 2022: <span id="base-electorate-display" class="font-mono"></span></span>
                                        <span class="text-sm font-mono text-primary"><span id="electorate-growth-value">0.0</span>%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- CAMPAIGN BOOST CONTROLS -->
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-chart-line mr-2"></i>Impulso de Campanha</h2>
                            <div id="party-boost-container" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div>
                        </div>
                        <!-- ALLIANCE SIMULATOR -->
                        <div class="bg-card p-5 rounded-lg border border-border">
                            <h2 class="text-lg font-bold mb-4 text-secondary"><i class="fa-solid fa-handshake mr-2"></i>Simulador de Alianças</h2>
                            <p class="text-xs text-text-light mb-3">Selecione 2 ou mais partidos para analisar uma possível coligação.</p>
                            <div id="alliance-party-container" class="flex flex-wrap gap-2 mb-4"></div>
                            <button id="alliance-button" onclick="simularAlianca()" class="w-full bg-primary text-white font-bold py-2 rounded-lg shadow-md hover:bg-violet-500 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Analisar Aliança
                            </button>
                        </div>
                    </aside>

                    <!-- Main Dashboard -->
                    <section class="lg:col-span-3 space-y-8">
                        <!-- Seat Distribution and At-Risk Chairs -->
                        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                            <div class="bg-card p-6 rounded-lg border border-border">
                                <h2 class="text-xl font-bold mb-4">Ranking de Oportunidade</h2>
                                <div id="vagas-dist-container" class="space-y-2"></div>
                            </div>
                            <div class="bg-card p-6 rounded-lg border border-border flex flex-col">
                                <h2 class="text-xl font-bold mb-4 text-danger"><i class="fa-solid fa-fire-flame-curved"></i>Cadeiras em Risco</h2>
                                <div id="risk-container" class="space-y-4 flex-grow overflow-y-auto pr-2"></div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            
            <!-- TAB: CANDIDATE DATABASE -->
            <div id="content-candidatos" class="hidden">
                 <div class="bg-card p-6 rounded-lg border border-border">
                    <h2 class="text-2xl font-bold mb-4">Base de Candidatos (Eleições 2022)</h2>
                    <div class="mb-6">
                        <input type="text" id="candidato-search" placeholder="Pesquisar por nome do candidato..." class="w-full p-3 bg-gray-900/50 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition">
                    </div>
                    <div id="candidatos-accordion-container" class="space-y-2">
                        <!-- Accordion will be generated here -->
                    </div>
                </div>
            </div>
            
            <!-- TAB: EDITAR LEGENDA -->
            <div id="content-editarLegenda" class="hidden">
                 <div class="bg-card p-6 rounded-lg border border-border">
                    <div class="flex justify-between items-center mb-6">
                         <h2 class="text-2xl font-bold text-secondary">Editor de Legendas Completo</h2>
                         <div>
                             <button class="bg-danger text-white font-bold py-2 px-4 rounded-lg mr-2" onclick="resetAllLegendas()">Restaurar Padrão</button>
                             <button class="bg-success text-white font-bold py-2 px-4 rounded-lg" onclick="saveAllLegendas()">Salvar Todas as Alterações</button>
                         </div>
                    </div>
                    <p class="text-text-light mb-6">Edite as listas de candidatos de todos os partidos. As alterações serão usadas nas simulações após serem salvas.</p>
                    <div id="full-legenda-editor-container" class="space-y-2">
                        <!-- Accordions will be generated here -->
                    </div>
                </div>
            </div>

            <!-- TAB: STRATEGIC ANALYSIS -->
            <div id="content-analise" class="hidden">
                <div class="space-y-8">
                    <div class="bg-card p-6 rounded-lg border border-border">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h2 class="text-2xl font-bold">Análise de Puxadores de Voto (Base 2022)</h2>
                                <p class="text-text-light mt-1">Identifica a concentração de votos nos principais candidatos de cada partido.</p>
                            </div>
                            <button onclick="resetAllData()" class="bg-danger hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg flex items-center text-sm">
                                <i class="fa-solid fa-undo mr-2"></i> Restaurar Dados Originais
                            </button>
                        </div>
                        <div id="analise-puxadores-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                            <!-- Vote puller analysis cards will be generated here -->
                        </div>
                    </div>
                    <div class="bg-card p-6 rounded-lg border border-border">
                        <h2 class="text-2xl font-bold mb-4">Análise de Eficiência de Votos (Base 2022)</h2>
                        <p class="text-text-light mb-6">Calcula o "custo" de cada cadeira conquistada pelo partido (Total de Votos / Cadeiras Eleitas). Partidos com menor custo foram mais eficientes em converter votos em representação.</p>
                        <div id="analise-eficiencia-container" class="space-y-4">
                            <!-- Efficiency analysis will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB: ELECTED IN 2024 -->
            <div id="content-eleitos2024" class="hidden">
                <div class="bg-card p-6 rounded-lg border border-border">
                    <div class="flex flex-col md:flex-row justify-between md:items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold">Relatório de Eleitos 2024</h2>
                            <p class="text-text-light mt-1">Dados dos candidatos eleitos, organizados por região e mapa interativo.</p>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <label for="region-select" class="text-sm font-medium text-text-light mr-2">Filtrar por Região:</label>
                            <select id="region-select" class="bg-gray-700 p-2 rounded-lg border border-border" onchange="filterEleitosByRegion(this.value)">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Interactive Map -->
                    <div id="map-container" class="w-full aspect-video mb-8">
                        <div id="map-tooltip"></div>
                    </div>

                    <!-- 2024 Elected Summary Panel -->
                    <div id="eleitos-2024-summary" class="mb-8"></div>

                    <div id="eleitos-2024-container">
                        <!-- Tables of elected candidates will be generated here -->
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Generic Modal for pop-ups -->
    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div id="modal-overlay" class="absolute inset-0 bg-black/70 modal-overlay" onclick="closeModal()"></div>
        <div id="modal-content" class="bg-card border border-border rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative modal-content">
            <!-- Modal content will be injected here -->
        </div>
    </div>

    <script>
    // =================================================================================
    // DATA AND CONFIGURATIONS
    // =================================================================================
    const DADOS_ELEICOES = { 'SC': { 'de': { vagas: 44, historico: [ { ano: 2022, eleitorado: 5495133, votos_validos: 4028852, votos_brancos: 289065, votos_nulos: 153702, abstencao: 0.1862, partidos: { 
        'PL': { votos: 878708, candidatos: [ { nome: 'Ana Campagnolo', votos: 196571, isEleito: true }, { nome: 'Sargento Lima', votos: 71185, isEleito: true }, { nome: 'Mauricio Eskudlark', votos: 65638, isEleito: true }, { nome: 'Jessé Lopes', votos: 55013, isEleito: true }, { nome: 'Carlos Humberto', votos: 46445, isEleito: true }, { nome: 'Ivan Naatz', votos: 45304, isEleito: true }, { nome: 'Berlanda', votos: 41488, isEleito: true }, { nome: 'Marcius Machado', votos: 39749, isEleito: true }, { nome: 'Massocco', votos: 31659, isEleito: true }, { nome: 'Oscar Gutz', votos: 26812, isEleito: true }, { nome: 'Soratto', votos: 25622, isEleito: true }, { nome: 'Maurício Peixer', votos: 22028, isEleito: false }, { nome: 'A Alex Brasil', votos: 20271, isEleito: false }, { nome: 'Jeferson Cardozo Canal Atalaia', votos: 17934, isEleito: false }, { nome: 'Rafael Laske - Mamão', votos: 15730, isEleito: false }, { nome: 'Frigo', votos: 15090, isEleito: false }, { nome: 'Leticia Mattos', votos: 11068, isEleito: false }, { nome: 'Dr. Jorge', votos: 8810, isEleito: false }, { nome: 'Neuri Mantelli', votos: 8484, isEleito: false }, { nome: 'Turibio Torres', votos: 7282, isEleito: false }, { nome: 'Alemãozinho - Claudir Henz', votos: 6893, isEleito: false }, { nome: 'Marcio Cardoso', votos: 5990, isEleito: false }, { nome: 'Roberto Salum', votos: 5082, isEleito: false }, { nome: 'Andresa Ribeiro', votos: 5071, isEleito: false }, { nome: 'A Guerreira Salete Cardoso', votos: 4829, isEleito: false }, { nome: 'Rabuja', votos: 4799, isEleito: false }, { nome: 'Maryanne Mattos', votos: 4420, isEleito: false }, { nome: 'Alex Wehrle Professor', votos: 3999, isEleito: false }, { nome: 'Eloir Dedonatti', votos: 3958, isEleito: false }, { nome: 'Enfermeiro Victor Nascimento', votos: 3700, isEleito: false }, { nome: 'Moacir Bertoldi', votos: 3688, isEleito: false }, { nome: 'Simone Lerner', votos: 2810, isEleito: false }, { nome: 'Leonardo Tatim', votos: 1650, isEleito: false }, { nome: 'Professor Hahne', votos: 1332, isEleito: false }, { nome: 'Odete Enfermeira', votos: 564, isEleito: false }, { nome: 'Engenheira Alessandra Kingeski', votos: 515, isEleito: false }, { nome: 'Betinha Thomaselli', votos: 506, isEleito: false }, { nome: 'Sueli Zincoski', votos: 407, isEleito: false }, { nome: 'Marta Efrayim', votos: 135, isEleito: false }, { nome: 'Silvana', votos: 112, isEleito: false } ] }, 
        'MDB': { votos: 505571, candidatos: [ { nome: 'Antídio Lunelli', votos: 74500, isEleito: true }, { nome: 'Mauro de Nadal', votos: 67065, isEleito: true }, { nome: 'Jerry Comper', votos: 64145, isEleito: true }, { nome: 'Fernando Krelling', votos: 54320, isEleito: true }, { nome: 'Volnei Weber', votos: 45995, isEleito: true }, { nome: 'Tiago Zilli', votos: 33733, isEleito: true }, { nome: 'Emerson Stein', votos: 25063, isEleito: false }, { nome: 'Rosi Maldaner', votos: 20189, isEleito: false }, { nome: 'Dirce Heiderscheidt', votos: 16906, isEleito: false }, { nome: 'Adilson Girardi', votos: 15943, isEleito: false }, { nome: 'Cleiton Fossa', votos: 12364, isEleito: false }, { nome: 'Paulo Basilio', votos: 10561, isEleito: false }, { nome: 'Carelli', votos: 10138, isEleito: false }, { nome: 'Suelen Geremia', votos: 4825, isEleito: false }, { nome: 'Marcelo Fett', votos: 4552, isEleito: false }, { nome: 'Ari Galeski', votos: 4473, isEleito: false }, { nome: 'Guella', votos: 3743, isEleito: false }, { nome: 'Juarez Matos', votos: 3602, isEleito: false }, { nome: 'Flávia Vicente', votos: 2943, isEleito: false }, { nome: 'Professor Toldo', votos: 2027, isEleito: false }, { nome: 'William', votos: 1685, isEleito: false }, { nome: 'Leila Conci', votos: 1502, isEleito: false }, { nome: 'Psicóloga Ronize Ferreira', votos: 1478, isEleito: false }, { nome: 'Mano Cadore', votos: 1359, isEleito: false }, { nome: 'Chico Bento', votos: 1089, isEleito: false }, { nome: 'Micheline', votos: 803, isEleito: false }, { nome: 'Biriba', votos: 553, isEleito: false }, { nome: 'Jairo Santos', votos: 292, isEleito: false }, { nome: 'Franciel Britos', votos: 233, isEleito: false }, { nome: 'Mairi', votos: 110, isEleito: false }, { nome: 'Zélia Grah', votos: 71, isEleito: false }, { nome: 'Keli Cordeiro', votos: 42, isEleito: false } ] }, 
        'PT': { votos: 438030, candidatos: [ { nome: 'Luciane Carminatti', votos: 92478, isEleito: true }, { nome: 'Neodi Saretta', votos: 38729, isEleito: true }, { nome: 'Fabiano da Luz', votos: 34972, isEleito: true }, { nome: 'Padre Pedro', votos: 26803, isEleito: true }, { nome: 'Professora Vanessa da Rosa', votos: 16832, isEleito: false }, { nome: 'Paulo Eccel', votos: 16561, isEleito: false }, { nome: 'Dirceu Dresch', votos: 14370, isEleito: false }, { nome: 'Rodrigo Preis', votos: 12844, isEleito: false }, { nome: 'Luci Choinacki', votos: 12699, isEleito: false }, { nome: 'Jean Volpato', votos: 12499, isEleito: false }, { nome: 'Adriano Pereira', votos: 10988, isEleito: false }, { nome: 'Celso Zuchi', votos: 9159, isEleito: false }, { nome: 'Professor Lino Peres', votos: 8619, isEleito: false }, { nome: 'Rodolfo de Ramos', votos: 8128, isEleito: false }, { nome: 'Marisa Zanoni', votos: 7826, isEleito: false }, { nome: 'Dani Coletivo Juventude', votos: 7752, isEleito: false }, { nome: 'Júlio Bittencourt', votos: 7495, isEleito: false }, { nome: 'Célio Elias', votos: 6938, isEleito: false }, { nome: 'Adriana Rossi', votos: 6188, isEleito: false }, { nome: 'Professor Alessandro', votos: 5404, isEleito: false }, { nome: 'Cléo Comunello', votos: 5171, isEleito: false }, { nome: 'Glauter', votos: 4070, isEleito: false }, { nome: 'Vanda Pinedo Nossa Força e Voz', votos: 3978, isEleito: false }, { nome: 'Matheus Madeira', votos: 3853, isEleito: false }, { nome: 'Professor Raul Ribas', votos: 3822, isEleito: false }, { nome: 'Rodrigo de Oliveira', votos: 3730, isEleito: false }, { nome: 'Claudia Bratti', votos: 3425, isEleito: false }, { nome: 'Tomio', votos: 2396, isEleito: false }, { nome: 'Valmor de Paula', votos: 2311, isEleito: false }, { nome: 'Sérgio', votos: 2279, isEleito: false }, { nome: 'Professor Chico do Sinte', votos: 2257, isEleito: false }, { nome: 'Gislaine Durski', votos: 2237, isEleito: false }, { nome: 'Elvira Manfroi', votos: 2219, isEleito: false }, { nome: 'Rafael Coletivo Feliz de Novo', votos: 1047, isEleito: false }, { nome: 'Cláudio Márcio', votos: 547, isEleito: false } ] }, 
        'PSD': { votos: 293675, candidatos: [ { nome: 'Mario Motta', votos: 56363, isEleito: true }, { nome: 'Julio Garcia', votos: 49958, isEleito: true }, { nome: 'Napoleão Bernardes', votos: 36923, isEleito: true }, { nome: 'Zé Caramori', votos: 24394, isEleito: false }, { nome: 'Gerri da Consoli', votos: 22668, isEleito: false }, { nome: 'Silvio Alexandre Zancanaro', votos: 19672, isEleito: false }, { nome: 'Adeliana Dal Pont', votos: 18484, isEleito: false }, { nome: 'Polaco', votos: 9719, isEleito: false }, { nome: 'Wellington', votos: 8381, isEleito: false }, { nome: 'Mario Marcondes', votos: 7739, isEleito: false }, { nome: 'Gerson', votos: 3265, isEleito: false }, { nome: 'Carla Hofmann', votos: 3014, isEleito: false }, { nome: 'Arlindo Cruz', votos: 2559, isEleito: false }, { nome: 'Coronel Vonk', votos: 2352, isEleito: false }, { nome: 'Bete Werner Quandt', votos: 2037, isEleito: false }, { nome: 'Deyvid Breis Boca Aberta', votos: 1369, isEleito: false }, { nome: 'Sargento Stoklosa', votos: 1217, isEleito: false }, { nome: 'Helenice Pereira Duarte', votos: 1056, isEleito: false }, { nome: 'Cláudio Motoboy do Coletivo SC', votos: 1054, isEleito: false }, { nome: 'Ciro Girardi', votos: 995, isEleito: false }, { nome: 'Marcia Badalotti', votos: 801, isEleito: false }, { nome: 'Voltolini Taxista', votos: 736, isEleito: false }, { nome: 'Inajara Rodrigues', votos: 589, isEleito: false }, { nome: 'Henrique Ávila', votos: 382, isEleito: false }, { nome: 'Isa Simas', votos: 151, isEleito: false }, { nome: 'Katielly Lanzini', votos: 53, isEleito: false } ] },
        'PP': { votos: 280551, candidatos: [ { nome: 'Zé Milton', votos: 56585, isEleito: true }, { nome: 'Altair Silva', votos: 46086, isEleito: true }, { nome: 'Pepê Collaço', votos: 28809, isEleito: true }, { nome: 'Pedrão', votos: 27344, isEleito: false }, { nome: 'João Amin', votos: 19154, isEleito: false }, { nome: 'Luizinho da Regional', votos: 15324, isEleito: false }, { nome: 'Fernando Cruzzetta', votos: 10650, isEleito: false }, { nome: 'Anelisio da Assessoritec', votos: 9848, isEleito: false }, { nome: 'Almir Vieira', votos: 9390, isEleito: false }, { nome: 'Magno Bollmann', votos: 9278, isEleito: false }, { nome: 'Maurilio Moraes', votos: 7981, isEleito: false }, { nome: 'Cattoni', votos: 4789, isEleito: false }, { nome: 'Diego Pandini Diabo Loiro', votos: 4700, isEleito: false }, { nome: 'Mara da Saúde', votos: 4654, isEleito: false }, { nome: 'Julio Kaminski', votos: 3546, isEleito: false }, { nome: 'Gaúcho Amarelo', votos: 3537, isEleito: false }, { nome: 'Douglas Steffen Contador', votos: 2516, isEleito: false }, { nome: 'Katsumi', votos: 2506, isEleito: false }, { nome: 'Manjuva Caminhoneiro', votos: 1395, isEleito: false }, { nome: 'Giovana Menegotto', votos: 1325, isEleito: false }, { nome: 'Simone Andrade', votos: 704, isEleito: false }, { nome: 'Paulinha do Big Lojão', votos: 697, isEleito: false }, { nome: 'Adri Joias', votos: 404, isEleito: false }, { nome: 'Eneida Pereira', votos: 398, isEleito: false }, { nome: 'Professora Rosa Maria Tesser', votos: 370, isEleito: false }, { nome: 'Cabo Camargo', votos: 344, isEleito: false }, { nome: 'Mabel Ziegler', votos: 228, isEleito: false }, { nome: 'João Mira Taxista', votos: 191, isEleito: false }, { nome: 'Luciano Niua', votos: 90, isEleito: false }, { nome: 'Mari Rieke', votos: 54, isEleito: false }, { nome: 'Jaques Rodrigues', votos: 16, isEleito: false } ] },
        'UNIÃO': { votos: 265764, candidatos: [ { nome: 'Jair Miotto', votos: 33682, isEleito: true }, { nome: 'Repórter Sérgio Guimarães', votos: 27977, isEleito: true }, { nome: 'Marcos da Rosa', votos: 25845, isEleito: true }, { nome: 'Laércio Schuster', votos: 24605, isEleito: false }, { nome: 'Constancio Maciel', votos: 23614, isEleito: false }, { nome: 'Márcio Burigo', votos: 15296, isEleito: false }, { nome: 'Felipe Estevão', votos: 15146, isEleito: false }, { nome: 'Dr João', votos: 12169, isEleito: false }, { nome: 'Tânia Larson', votos: 11556, isEleito: false }, { nome: 'Mauro Dresch', votos: 9424, isEleito: false }, { nome: 'Sidney Sabel', votos: 7295, isEleito: false }, { nome: 'Jaime Pasqualini', votos: 5857, isEleito: false }, { nome: 'Lioilson', votos: 5502, isEleito: false }, { nome: 'Nadir Bau', votos: 5453, isEleito: false }, { nome: 'Samuel Ramos', votos: 4557, isEleito: false }, { nome: 'Sub Tenente Wancarlos', votos: 3873, isEleito: false }, { nome: 'Abrahão Mussi', votos: 3126, isEleito: false }, { nome: 'Ezequiel de Souza', votos: 3081, isEleito: false }, { nome: 'Aa ST Veterana Margareth Prats', votos: 2650, isEleito: false }, { nome: 'Paulo Zwiefka', votos: 2306, isEleito: false }, { nome: 'Mari Schorr', votos: 2292, isEleito: false }, { nome: 'Professor Arlindo', votos: 1623, isEleito: false }, { nome: 'Fernando Amorim', votos: 1458, isEleito: false }, { nome: 'Sandro Fortes', votos: 1446, isEleito: false }, { nome: 'Ivan da Luz', votos: 1294, isEleito: false }, { nome: 'Cris da Saúde', votos: 1257, isEleito: false }, { nome: 'Luciano Camargo', votos: 1254, isEleito: false }, { nome: 'Nina', votos: 1034, isEleito: false }, { nome: 'Cleuse Soares', votos: 958, isEleito: false }, { nome: 'Mauro Goedert', votos: 857, isEleito: false }, { nome: 'Youtuber Gabriela Zamboni', votos: 562, isEleito: false }, { nome: 'Luis Olavo Nandi', votos: 521, isEleito: false }, { nome: 'Xuxa', votos: 504, isEleito: false }, { nome: 'Xandi da Toca', votos: 497, isEleito: false }, { nome: 'Márcia Gueno', votos: 398, isEleito: false }, { nome: 'Edilberto Santos', votos: 223, isEleito: false }, { nome: 'Bia Machado', votos: 144, isEleito: false }, { nome: 'Eliana Patriota', votos: 58, isEleito: false }, { nome: 'Arlene Ramon', votos: 32, isEleito: false } ] }, 
        'PODE': { votos: 237137, candidatos: [ { nome: 'Paulinha', votos: 58694, isEleito: true }, { nome: 'Camilo Martins', votos: 44925, isEleito: true }, { nome: 'Lucas Neves', votos: 23053, isEleito: true }, { nome: 'Daniel Candido', votos: 20110, isEleito: false }, { nome: 'Thiago Morastoni', votos: 19914, isEleito: false }, { nome: 'Janice Krasniak', votos: 12965, isEleito: false }, { nome: 'Rodrigo Fachini', votos: 12649, isEleito: false }, { nome: 'Gabrielzinho', votos: 11578, isEleito: false }, { nome: 'Dra Celina Dittrich', votos: 7279, isEleito: false }, { nome: 'Dentinho', votos: 6311, isEleito: false }, { nome: 'Enfermeiro Pablo', votos: 5477, isEleito: false }, { nome: 'Tiago Maestri', votos: 2403, isEleito: false }, { nome: 'Camila Nascimento', votos: 2062, isEleito: false }, { nome: 'Alessandra Pires', votos: 1608, isEleito: false }, { nome: 'Lucelma Baldi', votos: 1332, isEleito: false }, { nome: 'Rafael Mello', votos: 1085, isEleito: false }, { nome: 'Igor Araujo', votos: 471, isEleito: false }, { nome: 'Baiano', votos: 375, isEleito: false }, { nome: 'Francisco Nunes', votos: 81, isEleito: false }, { nome: 'Dr Cabral', votos: 40, isEleito: false } ] }, 
        'PSDB': { votos: 211208, candidatos: [ { nome: 'Marcos Vieira', votos: 48466, isEleito: true }, { nome: 'Dr. Vicente', votos: 39797, isEleito: true }, { nome: 'Acélio Casagrande', votos: 39032, isEleito: false }, { nome: 'Saulo Sperotto', votos: 28114, isEleito: false }, { nome: 'Anna Carolina Martins', votos: 18325, isEleito: false }, { nome: 'Professora Suzana', votos: 7799, isEleito: false }, { nome: 'Aroldo Frigo Junior', votos: 6342, isEleito: false }, { nome: 'Jens Mantau', votos: 5071, isEleito: false }, { nome: 'Giovana Galato', votos: 4824, isEleito: false }, { nome: 'Soraya Michels', votos: 2230, isEleito: false }, { nome: 'Márcio Pereira', votos: 1966, isEleito: false }, { nome: 'Dejair Teixeira', votos: 1667, isEleito: false }, { nome: 'Izaias Machado', votos: 542, isEleito: false }, { nome: 'Jackson Lucian', votos: 425, isEleito: false }, { nome: 'Bastião Vieira', votos: 400, isEleito: false }, { nome: 'Daniela Sebben', votos: 166, isEleito: false }, { nome: 'Dra. Gabryella Baptista', votos: 105, isEleito: false } ] }, 
        'REPU': { votos: 163410, candidatos: [ { nome: 'Sergio Motta', votos: 44666, isEleito: true }, { nome: 'Leandro Lima', votos: 16572, isEleito: false }, { nome: 'Egídio Beckhauser', votos: 16123, isEleito: false }, { nome: 'Edson Piriquto', votos: 14472, isEleito: false }, { nome: 'Edilene', votos: 14098, isEleito: false }, { nome: 'Renê', votos: 10654, isEleito: false }, { nome: 'Luciano Buligon', votos: 9965, isEleito: false }, { nome: 'Dr. André Motta', votos: 7131, isEleito: false }, { nome: 'Otto Quintino', votos: 6891, isEleito: false }, { nome: 'Jefferson Monteiro', votos: 5326, isEleito: false }, { nome: 'Altamir Montibeller', votos: 4645, isEleito: false }, { nome: 'Zé Dresch', votos: 4237, isEleito: false }, { nome: 'Motinha', votos: 3791, isEleito: false }, { nome: 'Coronel Vieira', votos: 3736, isEleito: false }, { nome: 'Sargento Floriano', votos: 2536, isEleito: false }, { nome: 'Marcio Tinte', votos: 2316, isEleito: false }, { nome: 'Samira Porto', votos: 1451, isEleito: false }, { nome: 'Jeferson Petry', votos: 985, isEleito: false }, { nome: 'Silvinho da Farmácia', votos: 676, isEleito: false }, { nome: 'Ney', votos: 519, isEleito: false }, { nome: 'Sgt Ari', votos: 513, isEleito: false }, { nome: 'Clovis Kruger', votos: 402, isEleito: false }, { nome: 'Emilene Jacomelli', votos: 334, isEleito: false }, { nome: 'Juliana Cardoso', votos: 329, isEleito: false }, { nome: 'Nara Simão', votos: 316, isEleito: false }, { nome: 'Lívia Oliveira', votos: 263, isEleito: false }, { nome: 'Rosana da Silva', votos: 247, isEleito: false }, { nome: 'Jhenniffer Breenstup', votos: 144, isEleito: false }, { nome: 'Mirian Avila', votos: 104, isEleito: false } ] }, 
        'NOVO': { votos: 136632, candidatos: [ { nome: 'Matheus Cadorin', votos: 12390, isEleito: true }, { nome: 'André de Oliveira', votos: 12165, isEleito: false }, { nome: 'Lucas Gotardo', votos: 10947, isEleito: false }, { nome: 'Bruno Win', votos: 8555, isEleito: false }, { nome: 'Murilo Schmitz', votos: 8005, isEleito: false }, { nome: 'Dadá Westphal', votos: 7522, isEleito: false }, { nome: 'Rafael Ary', votos: 6694, isEleito: false }, { nome: 'Isadora Piana', votos: 6674, isEleito: false }, { nome: 'Marcos Zanella', votos: 6397, isEleito: false }, { nome: 'Celso Strobel', votos: 5430, isEleito: false }, { nome: 'André Casagrande', votos: 5378, isEleito: false }, { nome: 'Day Borges', votos: 4947, isEleito: false }, { nome: 'Leandro Schmöckel Gonçalves', votos: 3801, isEleito: false }, { nome: 'Sabino', votos: 2702, isEleito: false }, { nome: 'Bia Borges', votos: 2553, isEleito: false }, { nome: 'Stevan Arcari (Tangará)', votos: 2532, isEleito: false }, { nome: 'Débora Pierini', votos: 2274, isEleito: false }, { nome: 'Jussara Isabel Tumelero', votos: 2173, isEleito: false }, { nome: 'Maria Fernanda Gatti', votos: 2155, isEleito: false }, { nome: 'Fernando Torquato', votos: 2154, isEleito: false }, { nome: 'Luzia Frohlich', votos: 1894, isEleito: false }, { nome: 'Yordan Gums', votos: 1887, isEleito: false }, { nome: 'Eduardo Sávio', votos: 1676, isEleito: false }, { nome: 'Giovane Ferreira', votos: 1671, isEleito: false }, { nome: 'Orides Neto', votos: 1530, isEleito: false }, { nome: 'Indi Herbert', votos: 912, isEleito: false }, { nome: 'Dalva Pazin Vencato', votos: 567, isEleito: false }, { nome: 'Fabricio Favoretto', votos: 548, isEleito: false }, { nome: 'Professora Eliane', votos: 495, isEleito: false }, { nome: 'Lindomar Fróes', votos: 260, isEleito: false }, { nome: 'Rafael Ricardo', votos: 249, isEleito: false } ] }, 
        'PTB': { votos: 96767, candidatos: [ { nome: 'Delegado Egidio Ferrari', votos: 34912, isEleito: true }, { nome: 'Junior Cardoso', votos: 14748, isEleito: false }, { nome: 'Jonata Mendes', votos: 4169, isEleito: false }, { nome: 'Sales', votos: 3300, isEleito: false }, { nome: 'Anselmini', votos: 3105, isEleito: false }, { nome: 'Luciane Stobe', votos: 3036, isEleito: false }, { nome: 'Policial Miriam Lago', votos: 2668, isEleito: false }, { nome: 'Tia Gisele', votos: 2527, isEleito: false }, { nome: 'Juliano Martins', votos: 2492, isEleito: false }, { nome: 'João Cechinel', votos: 2265, isEleito: false }, { nome: 'Marcelindo Gruner', votos: 1776, isEleito: false }, { nome: 'Levi da Pesca', votos: 1462, isEleito: false }, { nome: 'Miriã de Schroeder', votos: 1272, isEleito: false }, { nome: 'Eduardo Bastos', votos: 1205, isEleito: false }, { nome: 'Pastor Paulo', votos: 1107, isEleito: false }, { nome: 'Marcos Angioletti Coca', votos: 1064, isEleito: false }, { nome: 'Antoninho Caminhoneiro', votos: 1019, isEleito: false }, { nome: 'Mirna Bublitz', votos: 919, isEleito: false }, { nome: 'Cláudia Lindner', votos: 884, isEleito: false }, { nome: 'Sargento Appel', votos: 618, isEleito: false }, { nome: 'Carlito o Amigo do Povo', votos: 401, isEleito: false }, { nome: 'Adriana Miguel', votos: 390, isEleito: false }, { nome: 'Enfermeiro Digo Vargas', votos: 372, isEleito: false }, { nome: 'Will Martello', votos: 364, isEleito: false }, { nome: 'Girson Caminhoneiro', votos: 363, isEleito: false }, { nome: 'Evaldino Leite', votos: 215, isEleito: false }, { nome: 'Gel Fadel', votos: 203, isEleito: false }, { nome: 'Maicon Zabot', votos: 174, isEleito: false }, { nome: 'Tatiana Melo', votos: 172, isEleito: false }, { nome: 'Prof Clayton Benites Moita', votos: 135, isEleito: false }, { nome: 'Daniel Ferreira', votos: 111, isEleito: false }, { nome: 'Bruno Santos', votos: 67, isEleito: false }, { nome: 'Mary Marques', votos: 50, isEleito: false }, { nome: 'Lauren Borges', votos: 50, isEleito: false } ] }, 
        'PSB': { votos: 92851, candidatos: [ { nome: 'Juliano Campos', votos: 18816, isEleito: false }, { nome: 'Julio Ronconi', votos: 13341, isEleito: false }, { nome: 'Paulinho Weiss', votos: 8953, isEleito: false }, { nome: 'Enfermeiro Gelson Albuquerque', votos: 4371, isEleito: false }, { nome: 'Renato Ladiada', votos: 4290, isEleito: false }, { nome: 'Decândido Magrão', votos: 3473, isEleito: false }, { nome: 'Professora Caren Machado', votos: 3149, isEleito: false }, { nome: 'Margareth Hernandes', votos: 1792, isEleito: false }, { nome: 'João Rinaldi', votos: 1654, isEleito: false }, { nome: 'Thais Fettback', votos: 1503, isEleito: false }, { nome: 'Brezola', votos: 1494, isEleito: false }, { nome: 'Delegado Thomé', votos: 1372, isEleito: false }, { nome: 'Devides Jean Rossi', votos: 1238, isEleito: false }, { nome: 'Dani Carneiro', votos: 1056, isEleito: false }, { nome: 'Eliane Ramos', votos: 1004, isEleito: false }, { nome: 'Lizete Contin', votos: 469, isEleito: false }, { nome: 'Julça', votos: 460, isEleito: false }, { nome: 'Dalva Assini', votos: 446, isEleito: false }, { nome: 'Antonio Carlos', votos: 326, isEleito: false }, { nome: 'Francine Canto', votos: 286, isEleito: false }, { nome: 'Rodrigo Duarte', votos: 157, isEleito: false }, { nome: 'Lorelone L. da Silva', votos: 154, isEleito: false }, { nome: 'Fred', votos: 146, isEleito: false }, { nome: 'Professor Osni Wagner', votos: 106, isEleito: false }, { nome: 'Rudi', votos: 106, isEleito: false }, { nome: 'Evandro Agostini', votos: 11, isEleito: false } ] }, 
        'PATRI': { votos: 88159, candidatos: [ { nome: 'Dr. Jonas', votos: 18296, isEleito: false }, { nome: 'Marcelo Brick', votos: 14444, isEleito: false }, { nome: 'Rafael Ramthun', votos: 13971, isEleito: false }, { nome: 'Professor Gilson', votos: 8322, isEleito: false }, { nome: 'Coronel Jeferson Schmidt', votos: 4444, isEleito: false }, { nome: 'Zé Henrique', votos: 3215, isEleito: false }, { nome: 'Wilson Cidrao', votos: 2884, isEleito: false }, { nome: 'Sargento Nobre', votos: 2308, isEleito: false }, { nome: 'Thati Teixeira', votos: 2004, isEleito: false }, { nome: 'Cabo Cabral', votos: 1861, isEleito: false }, { nome: 'Sargento Luizinho', votos: 1657, isEleito: false }, { nome: 'Mauro Fiscal', votos: 1402, isEleito: false }, { nome: 'Sub-Tenente Queiroz', votos: 1316, isEleito: false }, { nome: 'Gerson da Farmacia', votos: 1290, isEleito: false }, { nome: 'Fabio Campos', votos: 1156, isEleito: false }, { nome: 'Clair Lima', votos: 1107, isEleito: false }, { nome: 'Rodrigo Konrath', votos: 866, isEleito: false }, { nome: 'Rogério Piloto', votos: 860, isEleito: false }, { nome: 'Sub-Tenente Oliveira', votos: 692, isEleito: false }, { nome: 'Joaquim Chiniski', votos: 582, isEleito: false }, { nome: 'Dr. Christian Alves', votos: 510, isEleito: false }, { nome: 'Fuzileiro Oziel Santos', votos: 428, isEleito: false }, { nome: 'Jorge Vieira', votos: 383, isEleito: false }, { nome: 'Recalcati', votos: 359, isEleito: false }, { nome: 'Joao Silva', votos: 323, isEleito: false }, { nome: 'Leo Gois', votos: 306, isEleito: false }, { nome: 'Sabryna Medeiros', votos: 170, isEleito: false }, { nome: 'Angela Vieira', votos: 164, isEleito: false }, { nome: 'Alessandra Campos', votos: 163, isEleito: false }, { nome: 'Pastor Laudelino das Vans', votos: 156, isEleito: false }, { nome: 'Silvia Mendonça', votos: 151, isEleito: false }, { nome: 'Menegazzo', votos: 132, isEleito: false }, { nome: 'Barbara Costa', votos: 113, isEleito: false }, { nome: 'Marcos Paulista', votos: 111, isEleito: false }, { nome: 'Jean Marenzani', votos: 105, isEleito: false }, { nome: 'Cassy Bueno', votos: 103, isEleito: false }, { nome: 'Marcia Collares', votos: 68, isEleito: false }, { nome: 'Dinara Caroline', votos: 41, isEleito: false }, { nome: 'Marina Sorrentino', votos: 39, isEleito: false }, { nome: 'Pamella Carvalho', votos: 27, isEleito: false } ] }, 
        'PSOL': { votos: 83044, candidatos: [ { nome: 'Marquito', votos: 40329, isEleito: true }, { nome: 'Carolline Sardá', votos: 8221, isEleito: false }, { nome: 'Cíntia Mandata Bem Viver', votos: 7137, isEleito: false }, { nome: 'Livia - Coletiva Raízes', votos: 4205, isEleito: false }, { nome: 'Sargento Amauri Soares', votos: 3527, isEleito: false }, { nome: 'Advogada Rosane', votos: 3387, isEleito: false }, { nome: 'Professor Pedro Cabral', votos: 2727, isEleito: false }, { nome: 'Jéssica Michels', votos: 2613, isEleito: false }, { nome: 'Tânia Ramos', votos: 2207, isEleito: false }, { nome: 'Zelize', votos: 1526, isEleito: false }, { nome: 'Erick Cardoso', votos: 804, isEleito: false }, { nome: 'Alex Stein', votos: 761, isEleito: false }, { nome: 'Thaís Tolentino', votos: 482, isEleito: false }, { nome: 'Matheus Rodrigues', votos: 415, isEleito: false }, { nome: 'Lucas Machado', votos: 385, isEleito: false }, { nome: 'João Porsch - Kiko', votos: 344, isEleito: false }, { nome: 'Andre Fernando Schneider', votos: 273, isEleito: false }, { nome: 'Gilson Carteiro', votos: 216, isEleito: false }, { nome: 'Jaqueline Porto', votos: 145, isEleito: false }, { nome: 'Gabriel Missel', votos: 108, isEleito: false }, { nome: 'Izabel Campos', votos: 90, isEleito: false }, { nome: 'Amarildo Narciso', votos: 72, isEleito: false } ] }, 
        'PDT': { votos: 82141, candidatos: [ { nome: 'Rodrigo Minotto', votos: 28685, isEleito: true }, { nome: 'Prof Daniel Westrupp', votos: 7533, isEleito: false }, { nome: 'André Guesser', votos: 5548, isEleito: false }, { nome: 'Toni Duarte', votos: 4067, isEleito: false }, { nome: 'Jana Guedes', votos: 3984, isEleito: false }, { nome: 'Dorlei', votos: 3109, isEleito: false }, { nome: 'Nandinho Cysne', votos: 2830, isEleito: false }, { nome: 'Profe Mario Sergio Stramosk', votos: 2584, isEleito: false }, { nome: 'Elza Fortes', votos: 2385, isEleito: false }, { nome: 'Ciça Müller', votos: 2271, isEleito: false }, { nome: 'Natel', votos: 1787, isEleito: false }, { nome: 'Cleber Torra Torra', votos: 1715, isEleito: false }, { nome: 'Eduardo Furlanetto', votos: 1309, isEleito: false }, { nome: 'Roberto Bradonski', votos: 777, isEleito: false }, { nome: 'Thaliny', votos: 629, isEleito: false }, { nome: 'Dr Cleberson Garcia', votos: 625, isEleito: false }, { nome: 'Sodré', votos: 597, isEleito: false }, { nome: 'Adilsão', votos: 553, isEleito: false }, { nome: 'Sidiane Aparecida', votos: 508, isEleito: false }, { nome: 'Paulinho', votos: 464, isEleito: false }, { nome: 'Ronaldo Raulino', votos: 457, isEleito: false }, { nome: 'Jussara Inacio', votos: 413, isEleito: false }, { nome: 'Prof Bebeto Bagualito', votos: 324, isEleito: false }, { nome: 'Karinny Simas', votos: 321, isEleito: false }, { nome: 'Rafael Larangeira', votos: 288, isEleito: false }, { nome: 'Marciano da Liga de Lutas', votos: 282, isEleito: false }, { nome: 'Chico Twardovski', votos: 255, isEleito: false }, { nome: 'Renato Pai do Ame Jonatas', votos: 183, isEleito: false }, { nome: 'Sandra Guerreira', votos: 176, isEleito: false }, { nome: 'Nera', votos: 172, isEleito: false }, { nome: 'Apóstola Miriam Feijó', votos: 165, isEleito: false }, { nome: 'Eliana', votos: 153, isEleito: false }, { nome: 'Marcelo de Ogum', votos: 136, isEleito: false }, { nome: 'Rô', votos: 131, isEleito: false }, { nome: 'Vivinho', votos: 70, isEleito: false }, { nome: 'Fernando de Carvalho Ecotv', votos: 54, isEleito: false } ] },
        'DC': { votos: 30781, candidatos: [ { nome: 'Marcos Habitzreuter', votos: 7312, isEleito: false }, { nome: 'Jocimar Santos', votos: 6589, isEleito: false }, { nome: 'Thiago Zaboti', votos: 4886, isEleito: false }, { nome: 'Badotti', votos: 4127, isEleito: false }, { nome: 'Pastor Vanio de Oliveira', votos: 2722, isEleito: false }, { nome: 'Tiago Ronchi', votos: 1662, isEleito: false }, { nome: 'Mario Pereira Acepred', votos: 728, isEleito: false }, { nome: 'Andrea Vieira', votos: 596, isEleito: false }, { nome: 'Fran Kruck', votos: 282, isEleito: false }, { nome: 'Sergio Godinho', votos: 280, isEleito: false }, { nome: 'Emerson Rocha', votos: 272, isEleito: false }, { nome: 'Cabo Benassi', votos: 228, isEleito: false }, { nome: 'Vanderleia', votos: 141, isEleito: false }, { nome: 'José Barreiros', votos: 138, isEleito: false }, { nome: 'José Augusto', votos: 118, isEleito: false }, { nome: 'Fabricio Bianchini', votos: 105, isEleito: false }, { nome: 'Leandro', votos: 99, isEleito: false }, { nome: 'Alberto Silva', votos: 84, isEleito: false }, { nome: 'Adalberto Cassiano', votos: 66, isEleito: false }, { nome: 'Wellington Bahe', votos: 59, isEleito: false }, { nome: 'Jussara Guimaraes', votos: 43, isEleito: false }, { nome: 'Clélia', votos: 40, isEleito: false }, { nome: 'Vilma Lea Rebello', votos: 38, isEleito: false }, { nome: 'Jessica Vicentin', votos: 37, isEleito: false }, { nome: 'Soeli Rosa', votos: 16, isEleito: false }, { nome: 'Poliana', votos: 10, isEleito: false } ] },
        'SD': { votos: 30557, candidatos: [ { nome: 'Osmar Teixeira', votos: 24512, isEleito: false }, { nome: 'Douglas Silveira', votos: 1021, isEleito: false }, { nome: 'Biano Souza', votos: 716, isEleito: false }, { nome: 'Nogueira', votos: 694, isEleito: false }, { nome: 'Professora Angelica', votos: 576, isEleito: false }, { nome: 'Professora Carla', votos: 377, isEleito: false }, { nome: 'Dio Adelino', votos: 296, isEleito: false }, { nome: 'Sonia', votos: 282, isEleito: false }, { nome: 'Wilsimar Rocha', votos: 244, isEleito: false }, { nome: 'Maria Leal Deotti', votos: 239, isEleito: false }, { nome: 'Airtorcorpoealma', votos: 237, isEleito: false }, { nome: 'Jotta', votos: 220, isEleito: false }, { nome: 'Jonas Santos', votos: 213, isEleito: false }, { nome: 'Clayton Bertotto', votos: 170, isEleito: false }, { nome: 'Dr. Geancarlo', votos: 143, isEleito: false }, { nome: 'Tony Vargas', votos: 72, isEleito: false }, { nome: 'José', votos: 57, isEleito: false }, { nome: 'Shirlene Cecatto', votos: 49, isEleito: false }, { nome: 'Monique Walker', votos: 30, isEleito: false } ] },
        'PSC': { votos: 30036, candidatos: [ { nome: 'André Xavier', votos: 6534, isEleito: false }, { nome: 'Felippe Tessmann', votos: 3773, isEleito: false }, { nome: 'Julio Bento', votos: 3263, isEleito: false }, { nome: 'João Luiz da Bega', votos: 2999, isEleito: false }, { nome: 'Edson Bona', votos: 2788, isEleito: false }, { nome: 'Jeferson Dias', votos: 1738, isEleito: false }, { nome: 'Fanuel Refosco', votos: 1180, isEleito: false }, { nome: 'Advogado Claudio Melchioretto', votos: 1138, isEleito: false }, { nome: 'Osvaldo Borges', votos: 665, isEleito: false }, { nome: 'Carlão Metzger', votos: 575, isEleito: false }, { nome: 'Laila Graf', votos: 501, isEleito: false }, { nome: 'Vanderlei Rodrigo', votos: 484, isEleito: false }, { nome: 'Dico Pereira', votos: 405, isEleito: false }, { nome: 'Dr. Ezequias', votos: 367, isEleito: false }, { nome: 'Andre Schueda', votos: 328, isEleito: false }, { nome: 'Noé Hoepers', votos: 277, isEleito: false }, { nome: 'Telmo Demarch', votos: 256, isEleito: false }, { nome: 'Wilson Doin', votos: 255, isEleito: false }, { nome: 'Carla Baumer', votos: 204, isEleito: false }, { nome: 'Gizeli Nicoski', votos: 191, isEleito: false }, { nome: 'Rosemeri Caetano de Oliveira', votos: 177, isEleito: false }, { nome: 'Doutora Simone', votos: 135, isEleito: false }, { nome: 'Andrea Turcato', votos: 133, isEleito: false }, { nome: 'Isolde Kniess', votos: 131, isEleito: false }, { nome: 'Edir Candido', votos: 81, isEleito: false }, { nome: 'Neli Custódio', votos: 71, isEleito: false }, { nome: 'Reginaldo Santos', votos: 58, isEleito: false } ] },
        'CIDA': { votos: 25109, candidatos: [ { nome: 'Tiago Silva', votos: 11135, isEleito: false }, { nome: 'Delegadopj', votos: 3240, isEleito: false }, { nome: 'DRª Janine', votos: 1963, isEleito: false }, { nome: 'Caterine Nogueira', votos: 1945, isEleito: false }, { nome: 'Fabricio Marinho', votos: 1339, isEleito: false }, { nome: 'Pretto', votos: 1147, isEleito: false }, { nome: 'Pastor Antonio', votos: 906, isEleito: false }, { nome: 'Luciane Matteussi', votos: 533, isEleito: false }, { nome: 'Dr. Carlos de Antoni', votos: 165, isEleito: false }, { nome: 'Caique Geller', votos: 157, isEleito: false } ] },
        'PC do B': { votos: 17985, candidatos: [ { nome: 'Valduga', votos: 14665, isEleito: false }, { nome: 'Larissa Stephanie', votos: 2395, isEleito: false } ] },
        'AVAN': { votos: 8610, candidatos: [ { nome: 'Vitor Leopoldo', votos: 1820, isEleito: false }, { nome: 'Edina Esmeraldino', votos: 1587, isEleito: false }, { nome: 'Thalyson de Bairros', votos: 1102, isEleito: false }, { nome: 'Índio Fotógrafo', votos: 1071, isEleito: false }, { nome: 'Marcio Santos', votos: 608, isEleito: false }, { nome: 'Jacó de Freitas', votos: 386, isEleito: false }, { nome: 'Edson Mateus', votos: 291, isEleito: false }, { nome: 'DRª Gisele Lima', votos: 271, isEleito: false }, { nome: 'Oberziner', votos: 236, isEleito: false }, { nome: 'Alazão', votos: 228, isEleito: false }, { nome: 'Professor Juan', votos: 154, isEleito: false }, { nome: 'Vanio Vieira', votos: 126, isEleito: false }, { nome: 'Dai Freitas', votos: 94, isEleito: false }, { nome: 'Ivo da Silva', votos: 85, isEleito: false }, { nome: 'Adriana Haskel', votos: 70, isEleito: false }, { nome: 'Carla Roberta', votos: 65, isEleito: false }, { nome: 'Luizinho do Sacolão', votos: 50, isEleito: false }, { nome: 'Rosi Prudêncio', votos: 15, isEleito: false } ] },
        'PRTB': { votos: 3126, candidatos: [ { nome: 'João Fatini', votos: 760, isEleito: false }, { nome: 'Ari Espíndula', votos: 738, isEleito: false }, { nome: 'Rondnelli Panela Velha', votos: 577, isEleito: false }, { nome: 'Glaudistoni Felix', votos: 445, isEleito: false }, { nome: 'Marcelo Amaral Fontoura', votos: 114, isEleito: false }, { nome: 'Adri Kruger', votos: 86, isEleito: false }, { nome: 'Andreia Machado', votos: 54, isEleito: false }, { nome: 'Roberta Marques', votos: 39, isEleito: false }, { nome: 'Gustavo Machado', votos: 13, isEleito: false } ] },
        'REDE': { votos: 1501, candidatos: [ { nome: 'Sagui Jornaleiro', votos: 318, isEleito: false }, { nome: 'Jair Barbosa', votos: 301, isEleito: false }, { nome: 'Juliano Bueno', votos: 192, isEleito: false }, { nome: 'Joani Moçambique', votos: 111, isEleito: false }, { nome: 'Eliane Greggio', votos: 78, isEleito: false }, { nome: 'Grazi Silva', votos: 35, isEleito: false }, { nome: 'Geva Ferro', votos: 15, isEleito: false } ] },
        'PSTU': { votos: 1083, candidatos: [ { nome: 'Carlos Coletivo Educação', votos: 381, isEleito: false } ] },
        'PROS': { votos: 1010, candidatos: [ { nome: 'Vagner Visoli', votos: 385, isEleito: false }, { nome: 'Felipe Yago', votos: 329, isEleito: false }, { nome: 'Caio Vieira', votos: 66, isEleito: false } ] },
        'PV': { votos: 590, candidatos: [ { nome: 'Márcia Hasse', votos: 86, isEleito: false }, { nome: 'Frank Lôbo', votos: 63, isEleito: false } ] },
        'PCO': { votos: 0, candidatos: [ { nome: 'Arthur Cesconetto Souza', votos: 155, isEleito: false } ] }
    } } ] } } };
    const PARTY_COLORS = { 'PL': '#0ea5e9', 'MDB': '#facc15', 'PT': '#dc2626', 'PODE': '#38bdf8', 'PP': '#0284c7', 'PSD': '#f97316', 'UNIÃO': '#1e3a8a', 'PSDB': '#0c4a6e', 'REPU': '#2563eb', 'NOVO': '#ea580c', 'PTB': '#4b5563', 'PSB': '#ef4444', 'PATRI': '#059669', 'PSOL': '#f59e0b', 'PDT': '#0d9488', 'DC': '#166534', 'SD': '#f97316', 'PSC': '#2563eb', 'CIDA': '#65a30d', 'PC do B': '#ef4444', 'AVAN': '#0ea5e9', 'PRTB': '#0891b2', 'REDE': '#22c55e', 'PSTU': '#dc2626', 'PROS': '#f97316', 'PV': '#22c55e', 'PCO': '#7f1d1d', 'PRD': '#5a2d82', 'PMB': '#f4a460', 'PODEMO': '#00ced1' };
    
    let baseScenario = {};
    let currentSimulatedScenario = {};
    let baseSummary2022 = {};
    let totalSupportVotes = 0;

    // =================================================================================
    // MAIN LOGIC
    // =================================================================================
    document.addEventListener('DOMContentLoaded', () => {
        baseScenario = prepareBaseScenario();
        initializeControls();
        initializeCandidatosTab();
        initializeEditarLegendaTab();
        initializeAnaliseTab();
        initializeEleitos2024Tab();
        calculateBaseSummary2022();
        updateScenario();
    });

    /**
     * Prepares the initial scenario data from the raw 2022 election results.
     * This function creates a clean, workable data structure for the simulator.
     */
    function prepareBaseScenario() {
        // Deep copy to avoid modifying the original DADOS_ELEICOES object
        const historico2022 = JSON.parse(JSON.stringify(DADOS_ELEICOES.SC.de.historico.find(h => h.ano === 2022)));
        const comparecimentoBase2022 = historico2022.votos_validos + historico2022.votos_brancos + historico2022.votos_nulos;

        const partidos = Object.keys(historico2022.partidos).map(nome => {
            const p2022 = historico2022.partidos[nome];
            const candidatos = p2022.candidatos.map(c => ({ ...c, growth: 0 })).sort((a,b) => b.votos - a.votos);
            return {
                nome,
                votosBase2022: p2022.votos,
                candidatos: candidatos,
                customCandidatos: null, // For custom candidate lists
                boost: 0
            };
        });

        return {
            eleitoradoBase2022: historico2022.eleitorado,
            votosValidosBase2022: historico2022.votos_validos,
            votosBrancosBase2022: historico2022.votos_brancos,
            votosNulosBase2022: historico2022.votos_nulos,
            percentualValidosBase: historico2022.votos_validos / comparecimentoBase2022,
            percentualBrancosBase: historico2022.votos_brancos / comparecimentoBase2022,
            percentualNulosBase: historico2022.votos_nulos / comparecimentoBase2022,
            partidos
        };
    }
    
    /**
     * Initializes all the interactive controls in the sidebar (boost sliders, alliance checkboxes).
     */
    function initializeControls() {
        const boostContainer = document.getElementById('party-boost-container');
        const allianceContainer = document.getElementById('alliance-party-container');
        boostContainer.innerHTML = '';
        allianceContainer.innerHTML = '';
        
        // Populate the base 2022 data displays
        document.getElementById('base-abstention-display').textContent = (DADOS_ELEICOES.SC.de.historico[0].abstencao * 100).toFixed(1);
        document.getElementById('base-electorate-display').textContent = DADOS_ELEICOES.SC.de.historico[0].eleitorado.toLocaleString('pt-BR');

        baseScenario.partidos.sort((a,b) => b.votosBase2022 - a.votosBase2022).forEach(p => {
            const color = PARTY_COLORS[p.nome] || '#64748b';
            
            // Boost controls
            const boostItem = document.createElement('div');
            boostItem.innerHTML = `
                <label for="boost-${p.nome}" class="flex items-center text-sm font-medium text-text-light mb-1">
                    <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${color}"></div>
                    ${p.nome}
                </label>
                <div class="flex items-center space-x-2">
                    <input type="range" id="boost-${p.nome}" min="-20" max="20" value="0" step="1" class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer" oninput="updateScenario()">
                    <span id="boost-value-${p.nome}" class="font-mono text-xs w-12 text-right">0%</span>
                </div>
            `;
            boostContainer.appendChild(boostItem);

            // Alliance controls
            const allianceItem = document.createElement('div');
            allianceItem.innerHTML = `
                <input type="checkbox" id="alliance-${p.nome}" value="${p.nome}" class="hidden alliance-checkbox" onchange="updateAllianceButton()">
                <label for="alliance-${p.nome}" class="cursor-pointer border border-border px-2 py-1 rounded-md text-xs font-semibold text-text-light transition-all duration-200">${p.nome}</label>
            `;
            allianceContainer.appendChild(allianceItem);
        });
    }

    /**
     * Main trigger function. Called whenever a control is changed.
     * It reads all control values, calculates the new scenario, and calls rendering functions.
     */
    function updateScenario() {
        const abstentionRate = parseFloat(document.getElementById('abstention-rate').value) / 100;
        const electorateGrowth = parseFloat(document.getElementById('electorate-growth').value) / 100;
        document.getElementById('abstention-value').textContent = (abstentionRate * 100).toFixed(1);
        document.getElementById('electorate-growth-value').textContent = (electorateGrowth * 100).toFixed(1);

        baseScenario.partidos.forEach(p => {
            const boostInput = document.getElementById(`boost-${p.nome}`);
            if (boostInput && !boostInput.disabled) {
                p.boost = parseFloat(boostInput.value) / 100;
                const boostValueEl = document.getElementById(`boost-value-${p.nome}`);
                if(boostValueEl) boostValueEl.textContent = `${(p.boost * 100).toFixed(0)}%`;
            }
        });
        
        currentSimulatedScenario = calculateSimulatedScenario(abstentionRate, electorateGrowth);
        renderAll(currentSimulatedScenario);
    }

    /**
     * The core calculation engine of the simulator.
     * @param {number} abstentionRate - The simulated abstention rate (e.g., 0.186).
     * @param {number} electorateGrowth - The simulated electorate growth (e.g., 0.05).
     * @param {string[]} [allianceParties=[]] - An array of party names to be treated as a single alliance.
     * @returns {object} The complete simulated scenario object.
     */
    function calculateSimulatedScenario(abstentionRate, electorateGrowth, allianceParties = []) {
        const eleitoradoProjetado = Math.floor(baseScenario.eleitoradoBase2022 * (1 + electorateGrowth));
        const comparecimentoProjetado = Math.floor(eleitoradoProjetado * (1 - abstentionRate));
        
        const votosValidosProjetado = Math.floor(comparecimentoProjetado * baseScenario.percentualValidosBase);
        const votosBrancosProjetado = Math.floor(comparecimentoProjetado * baseScenario.percentualBrancosBase);
        const votosNulosProjetado = Math.floor(comparecimentoProjetado * baseScenario.percentualNulosBase);

        const QE = Math.floor(votosValidosProjetado / DADOS_ELEICOES.SC.de.vagas);

        let partidosSimulados = baseScenario.partidos.map(p => {
            let votosFinais;
            let notaCorte;
            let eleitos;
            let votosProjetadosBase;

            if (p.customCandidatos) {
                votosProjetadosBase = p.customCandidatos.reduce((sum, cand) => sum + Math.floor(cand.votos * (1 + (cand.growth || 0))), 0);
                votosFinais = votosProjetadosBase;
                eleitos = p.customCandidatos.slice();
                const ultimoEleito = eleitos.length > 0 ? eleitos[Math.min(eleitos.length, 40) - 1] : null;
                notaCorte = ultimoEleito ? ultimoEleito.votos : 0;
            } else {
                votosProjetadosBase = p.candidatos.reduce((sum, cand) => {
                    return sum + Math.floor(cand.votos * (1 + (cand.growth || 0)));
                }, 0);
                
                votosFinais = Math.floor(votosProjetadosBase * (1 + p.boost));
                eleitos = p.candidatos.filter(c => c.isEleito);
                const ultimoEleitoBase = eleitos[eleitos.length - 1];
                notaCorte = ultimoEleitoBase ? Math.floor(ultimoEleitoBase.votos * (1 + p.boost)) : 0;
            }
            
            const notaCorteFinal = Math.max(notaCorte, (QE > 0 ? Math.ceil(QE * 0.10) : 0));

            return { ...p, votos: votosFinais, notaCorte: notaCorteFinal, eleitos2022: eleitos, votosProjetadosBase };
        });

        if (allianceParties.length > 1) {
            const allianceData = { nome: `ALIANÇA (${allianceParties.join('+')})`, votos: 0, notaCorte: 0, boost: 0, eleitos2022: [], votosProjetadosBase: 0 };
            const remainingParties = [];
            
            partidosSimulados.forEach(p => {
                if (allianceParties.includes(p.nome)) {
                    allianceData.votos += p.votos;
                    allianceData.votosProjetadosBase += p.votosProjetadosBase;
                    allianceData.notaCorte = Math.max(allianceData.notaCorte, p.notaCorte);
                    allianceData.eleitos2022.push(...p.eleitos2022);
                } else {
                    remainingParties.push(p);
                }
            });
            allianceData.eleitos2022.sort((a,b) => b.votos - a.votos);
            partidosSimulados = [allianceData, ...remainingParties];
        }

        const distributionResult = distributeVagas(partidosSimulados, QE);
        
        return { 
            ...distributionResult,
            QE, 
            totalVotosValidos: votosValidosProjetado,
            totalVotosBrancos: votosBrancosProjetado,
            totalVotosNulos: votosNulosProjetado,
            totalEleitores: eleitoradoProjetado,
        };
    }

    function distributeVagas(partidos, QE) {
        let cenarios = JSON.parse(JSON.stringify(partidos));
        let totalVagasDiretas = 0;

        cenarios.forEach(p => {
            p.vagasDiretas = (QE > 0) ? Math.floor(p.votos / QE) : 0;
            p.vagasSobras = 0;
            totalVagasDiretas += p.vagasDiretas;
        });

        let vagasSobrasRestantes = DADOS_ELEICOES.SC.de.vagas - totalVagasDiretas;
        let partidosAptos = cenarios.filter(p => p.votos >= (QE * 0.80));
        let sobrasLog = [];

        while (vagasSobrasRestantes > 0 && partidosAptos.length > 0) {
            partidosAptos.forEach(p => {
                p.mediaVotos = p.votos / (p.vagasDiretas + p.vagasSobras + 1);
            });
            partidosAptos.sort((a, b) => b.mediaVotos - a.mediaVotos);
            
            const vencedor = partidosAptos[0];
            if (vencedor) {
                vencedor.vagasSobras++;
                const perdedor = partidosAptos[1];
                sobrasLog.push({
                    vaga: DADOS_ELEICOES.SC.de.vagas - vagasSobrasRestantes + 1,
                    vencedor: vencedor.nome,
                    mediaVencedor: vencedor.mediaVotos,
                    perdedor: perdedor ? perdedor.nome : null,
                    mediaPerdedor: perdedor ? perdedor.mediaVotos : 0,
                });
                vagasSobrasRestantes--;
            } else {
                break;
            }
        }

        cenarios.forEach(p => { p.totalVagas = p.vagasDiretas + p.vagasSobras; });
        
        return { cenarios, sobrasLog };
    }
    
    // =================================================================================
    // RENDERING FUNCTIONS
    // =================================================================================
    function renderAll(simulatedScenario) {
        viewProjectedSummary(); // Default to projected view
        renderVagasDist(simulatedScenario.cenarios);
        renderRisk(simulatedScenario.sobrasLog.slice().reverse());
    }

    function viewBaseSummary() {
        document.getElementById('summary-vv').textContent = baseSummary2022.votos_validos.toLocaleString('pt-BR');
        document.getElementById('summary-qe').textContent = baseSummary2022.QE.toLocaleString('pt-BR');
        document.getElementById('summary-vb').textContent = baseSummary2022.votos_brancos.toLocaleString('pt-BR');
        document.getElementById('summary-vn').textContent = baseSummary2022.votos_nulos.toLocaleString('pt-BR');
        document.getElementById('summary-nc').textContent = baseSummary2022.notaCorte.toLocaleString('pt-BR');
        document.getElementById('summary-vr').textContent = baseSummary2022.emRisco;
        document.getElementById('summary-cadeiras').textContent = 40;

        document.getElementById('btn-cenario-base').classList.add('bg-primary', 'text-white');
        document.getElementById('btn-cenario-projetado').classList.remove('bg-primary', 'text-white');
    }

    function viewProjectedSummary() {
        const { QE, totalVotosValidos, totalVotosBrancos, totalVotosNulos, cenarios, sobrasLog } = currentSimulatedScenario;
        const partidosComVaga = cenarios.filter(p => p.totalVagas > 0);
        const notaCorteMedia = partidosComVaga.length > 0 ? Math.ceil(partidosComVaga.reduce((acc, p) => acc + p.notaCorte, 0) / partidosComVaga.length) : 0;
        
        document.getElementById('summary-vv').textContent = totalVotosValidos.toLocaleString('pt-BR');
        document.getElementById('summary-qe').textContent = QE.toLocaleString('pt-BR');
        document.getElementById('summary-vb').textContent = totalVotosBrancos.toLocaleString('pt-BR');
        document.getElementById('summary-vn').textContent = totalVotosNulos.toLocaleString('pt-BR');
        document.getElementById('summary-nc').textContent = (notaCorteMedia || 0).toLocaleString('pt-BR');
        document.getElementById('summary-vr').textContent = sobrasLog.length.toLocaleString('pt-BR');
        document.getElementById('summary-cadeiras').textContent = DADOS_ELEICOES.SC.de.vagas;

        document.getElementById('btn-cenario-projetado').classList.add('bg-primary', 'text-white');
        document.getElementById('btn-cenario-base').classList.remove('bg-primary', 'text-white');
    }

    function calculateBaseSummary2022() {
        const historico2022 = DADOS_ELEICOES.SC.de.historico.find(h => h.ano === 2022);
        const QE2022 = Math.floor(historico2022.votos_validos / 40);
        
        const partidos2022 = Object.keys(historico2022.partidos).map(nome => ({
            nome: nome,
            votos: historico2022.partidos[nome].votos
        }));

        // Simplified distribution for summary only
        let totalVagasDiretas = 0;
        partidos2022.forEach(p => {
            p.vagasDiretas = (QE2022 > 0) ? Math.floor(p.votos / QE2022) : 0;
            p.vagasSobras = 0;
            totalVagasDiretas += p.vagasDiretas;
        });
        const emRisco = 40 - totalVagasDiretas;

        // Calculate average note de corte from raw data
        let notasDeCorte = [];
        Object.values(historico2022.partidos).forEach(p => {
            const eleitos = p.candidatos.filter(c => c.isEleito);
            if (eleitos.length > 0) {
                const ultimoEleito = eleitos[eleitos.length - 1];
                notasDeCorte.push(ultimoEleito.votos);
            }
        });
        const notaCorteMedia = notasDeCorte.length > 0 ? Math.ceil(notasDeCorte.reduce((a, b) => a + b, 0) / notasDeCorte.length) : 0;

        baseSummary2022 = {
            votos_validos: historico2022.votos_validos,
            votos_brancos: historico2022.votos_brancos,
            votos_nulos: historico2022.votos_nulos,
            QE: QE2022,
            notaCorte: notaCorteMedia,
            emRisco: emRisco
        };
    }

    function renderVagasDist(cenarios) {
        const container = document.getElementById('vagas-dist-container');
        container.innerHTML = '';
        const sorted = [...cenarios].filter(p => p.totalVagas > 0).sort((a, b) => b.totalVagas - a.totalVagas);

        sorted.forEach(p => {
            const color = PARTY_COLORS[p.nome.split(' ')[0]] || '#64748b';
            const item = document.createElement('div');
            item.className = 'p-2 rounded-lg clickable';
            item.setAttribute('onclick', `showPartyModal('${p.nome}')`);
            const customIcon = p.customCandidatos ? '<i class="fa-solid fa-user-pen text-secondary text-xs ml-2"></i>' : '';
            item.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-2" style="background-color: ${color}"></div>
                        <span class="font-bold">${p.nome}</span>
                        ${customIcon}
                    </div>
                    <span class="font-bold text-lg">${p.totalVagas} <span class="text-sm font-normal text-text-light">vaga(s)</span></span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div class="bg-primary h-4 rounded-full party-bar" style="width: ${p.totalVagas > 0 ? (p.vagasDiretas / p.totalVagas * 100) : 0}%" title="Vagas Diretas: ${p.vagasDiretas}"></div>
                </div>
                <div class="text-xs text-text-light mt-1 flex justify-between">
                    <span>${p.vagasDiretas} direta(s) / ${p.vagasSobras} sobra(s)</span>
                    <span>NC: <span class="font-bold text-warning">${p.notaCorte.toLocaleString('pt-BR')}</span></span>
                </div>
            `;
            container.appendChild(item);
        });
    }

    function renderRisk(riskLog) {
        const container = document.getElementById('risk-container');
        container.innerHTML = '';
        if(riskLog.length === 0) {
            container.innerHTML = `<p class="text-center text-text-light p-4">Nenhuma vaga de sobra disputada neste cenário.</p>`;
            return;
        }

        riskLog.forEach((log, index) => {
            const diff = log.perdedor ? Math.ceil(log.mediaVencedor - log.mediaPerdedor) : 0;
            const item = document.createElement('div');
            item.className = 'bg-gray-900/50 p-3 rounded-lg risk-card gain clickable';
            item.setAttribute('onclick', `showRiskModal(${index})`);
            item.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="font-bold text-sm">VAGA #${log.vaga}</div>
                    <div class="text-xs font-mono bg-danger/20 text-danger px-2 py-0.5 rounded-full">ALTO RISCO</div>
                </div>
                <div class="mt-2 space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-success"><i class="fa-solid fa-circle-check mr-2"></i>GANHANDO: <strong>${log.vencedor}</strong></span>
                        <span class="font-mono text-text-main">${Math.ceil(log.mediaVencedor).toLocaleString('pt-BR')}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-text-light"><i class="fa-solid fa-circle-radiation mr-2"></i>AMEAÇANDO: <strong>${log.perdedor || 'N/A'}</strong></span>
                         <span class="font-mono text-text-main">${log.perdedor ? Math.ceil(log.mediaPerdedor).toLocaleString('pt-BR') : '-'}</span>
                    </div>
                </div>
                <div class="mt-2 pt-2 border-t border-border/50 text-center text-xs text-secondary">
                    Diferença de Média: <strong>${diff.toLocaleString('pt-BR')} votos</strong>
                </div>
            `;
            container.appendChild(item);
        });
    }
    
    // =================================================================================
    // MODAL LOGIC
    // =================================================================================
    function showModal(content) {
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        modalContent.innerHTML = content;
        modal.classList.remove('hidden');
        setTimeout(() => {
            document.getElementById('modal-overlay').classList.add('opacity-100');
            modalContent.classList.add('opacity-100', 'scale-100');
        }, 10);
    }

    function closeModal() {
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        document.getElementById('modal-overlay').classList.remove('opacity-100');
        modalContent.classList.remove('opacity-100', 'scale-100');
        setTimeout(() => {
            modal.classList.add('hidden');
            modalContent.innerHTML = '';
        }, 300);
    }
    
    function showPartyModal(partyName) {
        const partyData = currentSimulatedScenario.cenarios.find(p => p.nome === partyName);
        if (!partyData) return;

        const color = PARTY_COLORS[partyName.split(' ')[0]] || '#64748b';
        
        const diretas = Array.from({ length: partyData.vagasDiretas }, (_, i) => i);
        const sobras = Array.from({ length: partyData.vagasSobras }, (_, i) => i + partyData.vagasDiretas);

        const generateCandidateHtml = (index) => {
            const candidato = partyData.eleitos2022[index];
            if (!candidato) {
                return `<li class="bg-background p-2 rounded-md opacity-70"><div class="flex justify-between items-center"><span class="font-bold text-sm">${index + 1}. Nova Liderança</span><span class="font-bold text-lg text-warning">${partyData.notaCorte.toLocaleString('pt-BR')}</span></div><div class="text-xs text-text-light flex justify-between items-center mt-1"><span>Votos Base: N/A</span><span>Meta Mínima</span></div></li>`;
            }
            const votosProjetados = partyData.customCandidatos ? candidato.votos : Math.floor(candidato.votos * (1 + partyData.boost));
            const diff = votosProjetados - partyData.notaCorte;
            return `<li class="bg-background p-2 rounded-md"><div class="flex justify-between items-center"><span class="font-bold text-sm">${index + 1}. ${candidato.nome}</span><span class="font-bold text-lg text-primary">${votosProjetados.toLocaleString('pt-BR')}</span></div><div class="text-xs text-text-light flex justify-between items-center mt-1"><span>Votos Base: ${candidato.votos.toLocaleString('pt-BR')}</span><span class="${diff >= 0 ? 'text-success' : 'text-danger'}">${diff >= 0 ? '+' : ''}${diff.toLocaleString('pt-BR')} vs. NC</span></div></li>`;
        };

        const diretasHtml = diretas.length > 0 ? diretas.map(generateCandidateHtml).join('') : '<li class="text-sm text-text-light text-center p-2">Nenhuma cadeira direta.</li>';
        const sobrasHtml = sobras.length > 0 ? sobras.map(generateCandidateHtml).join('') : '<li class="text-sm text-text-light text-center p-2">Nenhuma cadeira de sobra.</li>';
        
        const ultimoEleitoBase = partyData.eleitos2022 && partyData.eleitos2022.length > 0 ? partyData.eleitos2022[partyData.eleitos2022.length - 1] : null;

        const modalHtml = `<div class="p-6 text-text-light"><div class="flex justify-between items-start mb-4"><div class="flex items-center"><div class="w-8 h-8 rounded-full mr-3" style="background-color: ${color}"></div><div><h2 class="text-2xl font-bold text-text-main">${partyName}</h2><p>Dossiê do Partido</p></div></div><button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div class="bg-background p-4 rounded-lg"><h3 class="font-bold mb-2 text-text-main">Votos</h3><ul class="text-sm space-y-2 font-mono"><li class="flex justify-between"><span>Base (2022):</span> <span>${(partyData.votosProjetadosBase).toLocaleString('pt-BR')}</span></li><li class="flex justify-between"><span>Impulso (${(partyData.boost * 100).toFixed(0)}%):</span> <span class="${partyData.boost > 0 ? 'text-success' : partyData.boost < 0 ? 'text-danger' : ''}">${(partyData.votos - partyData.votosProjetadosBase).toLocaleString('pt-BR')}</span></li><li class="flex justify-between border-t border-border pt-2 mt-2"><strong>TOTAL:</strong> <strong>${partyData.votos.toLocaleString('pt-BR')}</strong></li></ul></div><div class="bg-background p-4 rounded-lg"><h3 class="font-bold mb-2 text-text-main">Nota de Corte</h3><ul class="text-sm space-y-2 font-mono"><li class="flex justify-between"><span>Último Eleito (Base):</span> <span>${ultimoEleitoBase ? ultimoEleitoBase.votos.toLocaleString('pt-BR') : 'N/A'}</span></li><li class="flex justify-between"><span>Impulso:</span> <span>${(partyData.boost * 100).toFixed(0)}%</span></li><li class="flex justify-between border-t border-border pt-2 mt-2"><strong>META:</strong> <strong class="text-warning">${partyData.notaCorte.toLocaleString('pt-BR')}</strong></li></ul></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="bg-background p-4 rounded-lg"><h3 class="font-bold mb-2 text-text-main"><i class="fa-solid fa-bolt text-primary mr-1"></i>Diretas (${diretas.length})</h3><ul class="text-sm space-y-2">${diretasHtml}</ul></div><div class="bg-background p-4 rounded-lg"><h3 class="font-bold mb-2 text-text-main"><i class="fa-solid fa-shuffle text-warning mr-1"></i>Sobras (${sobras.length})</h3><ul class="text-sm space-y-2">${sobrasHtml}</ul></div></div></div>`;
        showModal(modalHtml);
    }

    function showRiskModal(logIndex) {
        const log = currentSimulatedScenario.sobrasLog.slice().reverse()[logIndex];
        if (!log) return;

        const { vencedor, perdedor, mediaVencedor, mediaPerdedor, vaga } = log;
        const diff = perdedor ? Math.ceil(mediaVencedor - mediaPerdedor) : 0;
        
        const perdedorData = currentSimulatedScenario.cenarios.find(p => p.nome === perdedor);

        let analise = '';
        if (perdedorData) {
            const votosNecessarios = Math.ceil((mediaVencedor - perdedorData.mediaVotos) * (perdedorData.totalVagas + 1));
            const boostNecessario = (perdedorData.votos > 0) ? (votosNecessarios / perdedorData.votos) * 100 : 0;
            analise = `<h3 class="font-bold mt-4 mb-2 text-secondary">Análise de Virada</h3><p class="text-sm">Para o <strong>${perdedor}</strong> tomar esta vaga, precisaria de <strong>${votosNecessarios.toLocaleString('pt-BR')}</strong> votos a mais, um "Impulso" de <strong>+${boostNecessario.toFixed(1)}%</strong>.</p>`;
        }

        const modalHtml = `<div class="p-6 text-text-light"><div class="flex justify-between items-start mb-4"><div><h2 class="text-2xl font-bold text-danger">Análise Tática: Vaga #${vaga}</h2><p>Disputa por uma cadeira de sobra.</p></div><button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button></div><div class="grid grid-cols-2 gap-4"><div class="bg-success/10 p-4 rounded-lg border border-success/30"><p class="text-sm font-bold text-success">GANHANDO</p><p class="text-xl font-bold">${vencedor}</p><p class="font-mono text-lg">${Math.ceil(mediaVencedor).toLocaleString('pt-BR')} <span class="text-xs text-text-light"> Média</span></p></div><div class="bg-warning/10 p-4 rounded-lg border border-warning/30"><p class="text-sm font-bold text-warning">AMEAÇA</p><p class="text-xl font-bold">${perdedor || 'N/A'}</p><p class="font-mono text-lg">${perdedor ? Math.ceil(mediaPerdedor).toLocaleString('pt-BR') : '-'} <span class="text-xs text-text-light"> Média</span></p></div></div><div class="mt-4 text-center bg-background p-3 rounded-lg"><p class="text-sm text-text-light">Diferença de Média</p><p class="text-2xl font-bold text-secondary">${diff.toLocaleString('pt-BR')} Votos</p></div><div class="bg-background p-4 rounded-lg mt-4">${analise}</div></div>`;
        showModal(modalHtml);
    }
    
    // =================================================================================
    // ALLIANCE SIMULATOR LOGIC
    // =================================================================================
    function updateAllianceButton() {
        document.getElementById('alliance-button').disabled = document.querySelectorAll('.alliance-checkbox:checked').length < 2;
    }

    function simularAlianca() {
        const selectedParties = Array.from(document.querySelectorAll('.alliance-checkbox:checked')).map(el => el.value);
        if (selectedParties.length < 2) return;

        const abstentionRate = parseFloat(document.getElementById('abstention-rate').value) / 100;
        const electorateGrowth = parseFloat(document.getElementById('electorate-growth').value) / 100;
        
        const allianceScenario = calculateSimulatedScenario(abstentionRate, electorateGrowth, selectedParties);
        const baselineScenario = currentSimulatedScenario;

        const allianceResult = allianceScenario.cenarios.find(p => p.nome.startsWith('ALIANÇA'));
        const vagasAlianca = allianceResult ? allianceResult.totalVagas : 0;

        let vagasSeparados = 0;
        selectedParties.forEach(partyName => {
            const baselineParty = baselineScenario.cenarios.find(p => p.nome === partyName);
            if (baselineParty) vagasSeparados += baselineParty.totalVagas;
        });

        const ganhoLiquido = vagasAlianca - vagasSeparados;
        let impactoHtml = '';
        baselineScenario.cenarios.forEach(baselineParty => {
            if (selectedParties.includes(baselineParty.nome)) return;
            const allianceParty = allianceScenario.cenarios.find(p => p.nome === baselineParty.nome);
            const diff = (allianceParty ? allianceParty.totalVagas : 0) - baselineParty.totalVagas;
            if (diff !== 0) {
                const color = diff > 0 ? 'text-success' : 'text-danger';
                const icon = diff > 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                impactoHtml += `<li class="flex justify-between"><span>${baselineParty.nome}</span> <span class="font-bold ${color}">${diff > 0 ? '+' : ''}${diff} vaga(s) <i class="fa-solid ${icon}"></i></span></li>`;
            }
        });

        const modalHtml = `<div class="p-6"><div class="flex justify-between items-start mb-4"><div><h2 class="text-2xl font-bold text-secondary">Análise de Aliança</h2><p class="text-text-light">${selectedParties.join(' + ')}</p></div><button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button></div><div class="grid grid-cols-2 gap-4 text-center"><div class="bg-background p-4 rounded-lg"><p class="text-sm text-text-light">Vagas (Separados)</p><p class="text-4xl font-bold">${vagasSeparados}</p></div><div class="bg-primary/20 p-4 rounded-lg"><p class="text-sm text-primary">Vagas (Aliança)</p><p class="text-4xl font-bold text-primary">${vagasAlianca}</p></div></div><div class="mt-4 text-center bg-background p-3 rounded-lg"><p class="text-sm text-text-light">Ganho Líquido</p><p class="text-2xl font-bold ${ganhoLiquido > 0 ? 'text-success' : ganhoLiquido < 0 ? 'text-danger' : ''}">${ganhoLiquido > 0 ? '+' : ''}${ganhoLiquido} Vaga(s)</p></div><div class="mt-4 bg-background p-4 rounded-lg"><h3 class="font-bold mb-2">Impacto no Cenário</h3><ul class="text-sm space-y-2">${impactoHtml || '<li class="text-text-light">Nenhum outro partido foi impactado.</li>'}</ul></div></div>`;
        showModal(modalHtml);
    }
    
    // =================================================================================
    // CUSTOM LIST EDITOR (TAB) LOGIC
    // =================================================================================
    function initializeEditarLegendaTab() {
        const container = document.getElementById('content-editarLegenda');
        container.innerHTML = `
            <div class="bg-card p-6 rounded-lg border border-border">
                <div class="flex justify-between items-center mb-6">
                     <h2 class="text-2xl font-bold text-secondary">Editor de Legendas Completo</h2>
                     <div>
                         <button class="bg-danger text-white font-bold py-2 px-4 rounded-lg mr-2" onclick="resetAllLegendas()">Restaurar Padrão</button>
                         <button class="bg-success text-white font-bold py-2 px-4 rounded-lg" onclick="saveAllLegendas()">Salvar Todas as Alterações</button>
                     </div>
                </div>
                <p class="text-text-light mb-6">Edite as listas de candidatos de todos os partidos. As alterações serão usadas nas simulações após serem salvas.</p>
                <div id="full-legenda-editor-container" class="space-y-2">
                    <!-- Accordions will be generated here -->
                </div>
            </div>
        `;

        const editorContainer = document.getElementById('full-legenda-editor-container');
        baseScenario.partidos.sort((a, b) => b.votosBase2022 - a.votosBase2022).forEach(party => {
            const color = PARTY_COLORS[party.nome] || '#64748b';
            const accordionItem = document.createElement('div');
            accordionItem.className = 'bg-gray-900/50 rounded-lg';
            const partyId = party.nome.replace(/[^a-zA-Z0-9]/g, '');
            accordionItem.id = `legenda-accordion-${partyId}`;

            const candidates = party.customCandidatos || party.candidatos;
            const totalVotosPartido = candidates.reduce((sum, cand) => sum + Math.floor(cand.votos * (1 + (cand.growth || 0))), 0);

            let candidatesHtml = candidates.map((cand, index) => `
                <div class="grid grid-cols-12 items-center gap-2 mb-2 candidate-row" data-original-index="${index}">
                    <input type="text" placeholder="Nome" value="${cand.nome}" class="col-span-5 bg-background p-2 rounded-lg border border-border">
                    <input type="number" placeholder="Votos" value="${cand.votos}" class="col-span-2 bg-background p-2 rounded-lg border border-border" oninput="updateProjectedVotesInEditor(this, '${partyId}')">
                    <div class="col-span-3 flex items-center gap-2">
                        <input type="number" placeholder="% Cresc." value="${(cand.growth || 0) * 100}" class="w-24 bg-background p-2 rounded-lg border border-border text-right" oninput="updateProjectedVotesInEditor(this, '${partyId}')">
                        <span class="text-sm text-text-light">%</span>
                    </div>
                    <strong class="col-span-2 text-primary text-right projected-votes">${Math.floor(cand.votos * (1 + (cand.growth || 0))).toLocaleString('pt-BR')}</strong>
                    <button class="bg-danger text-white px-3 py-2 rounded-lg" onclick="removeCandidateRowFromParty(this, '${partyId}')">&times;</button>
                    <button class="bg-secondary text-white px-3 py-2 rounded-lg" title="Migrar" onclick="migrateCandidateFromParty(this, '${party.nome}')"><i class="fa-solid fa-right-left"></i></button>
                </div>
            `).join('');

            accordionItem.innerHTML = `
                <button class="w-full p-4 text-left font-bold flex justify-between items-center text-text-main" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('i').classList.toggle('rotate-180')">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-3" style="background-color: ${color}"></div>
                        <span>${party.nome}</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-sm font-normal text-text-light">${candidates.length} cands.</span>
                        <span class="text-sm font-normal text-text-light">Total: <strong class="text-main" id="total-legenda-editor-${partyId}">${totalVotosPartido.toLocaleString('pt-BR')}</strong></span>
                        <i class="fa-solid fa-chevron-down transition-transform"></i>
                    </div>
                </button>
                <div class="p-4 border-t border-border hidden">
                    <div class="grid grid-cols-12 gap-2 mb-2 text-xs text-text-light">
                        <div class="col-span-5">Nome do Candidato</div>
                        <div class="col-span-2">Votos Base</div>
                        <div class="col-span-3">Crescimento</div>
                        <div class="col-span-2 text-right">Votos Projetados</div>
                    </div>
                    <div class="candidate-list-container space-y-2">${candidatesHtml}</div>
                    <button class="mt-4 text-sm text-primary" onclick="addCandidateRowToParty('${partyId}')"><i class="fa-solid fa-plus mr-2"></i>Adicionar Candidato</button>
                </div>
            `;
            editorContainer.appendChild(accordionItem);
        });
    }

    function updateProjectedVotesInEditor(element, partyId) {
        const row = element.closest('.candidate-row');
        const baseVotesInput = row.querySelector('input[type="number"]');
        const growthInput = row.querySelector('input[type="number"][placeholder="% Cresc."]');
        const projectedVotesDisplay = row.querySelector('.projected-votes');

        const baseVotes = parseInt(baseVotesInput.value, 10) || 0;
        const growth = parseFloat(growthInput.value) / 100 || 0;
        
        const projectedVotes = Math.floor(baseVotes * (1 + growth));
        projectedVotesDisplay.textContent = projectedVotes.toLocaleString('pt-BR');
        
        updateLegendaTotalVotes(partyId);
    }

    function updateLegendaTotalVotes(partyId) {
        const container = document.querySelector(`#legenda-accordion-${partyId}`);
        if (!container) return;
        
        let totalVotes = 0;
        const rows = container.querySelectorAll('.candidate-row');
        rows.forEach(row => {
            const projectedVotesText = row.querySelector('.projected-votes').textContent;
            totalVotes += parseInt(projectedVotesText.replace(/\./g, ''), 10) || 0;
        });

        const totalDisplay = container.querySelector(`#total-legenda-editor-${partyId}`);
        if (totalDisplay) {
            totalDisplay.textContent = totalVotes.toLocaleString('pt-BR');
        }
    }

    function addCandidateRowToParty(partyId) {
        const container = document.querySelector(`#legenda-accordion-${partyId} .candidate-list-container`);
        const newRow = document.createElement('div');
        newRow.className = 'grid grid-cols-12 items-center gap-2 mb-2 candidate-row';
        newRow.innerHTML = `
            <input type="text" placeholder="Nome do Novo Candidato" class="col-span-5 bg-background p-2 rounded-lg border border-border">
            <input type="number" placeholder="Votos" value="0" class="col-span-2 bg-background p-2 rounded-lg border border-border" oninput="updateProjectedVotesInEditor(this, '${partyId}')">
            <div class="col-span-3 flex items-center gap-2">
                <input type="number" placeholder="% Cresc." value="0" class="w-24 bg-background p-2 rounded-lg border border-border text-right" oninput="updateProjectedVotesInEditor(this, '${partyId}')">
                <span class="text-sm text-text-light">%</span>
            </div>
            <strong class="col-span-2 text-primary text-right projected-votes">0</strong>
            <button class="bg-danger text-white px-3 py-2 rounded-lg" onclick="removeCandidateRowFromParty(this, '${partyId}')">&times;</button>
            <button class="bg-secondary text-white px-3 py-2 rounded-lg" title="Migrar" onclick="migrateCandidateFromParty(this, '${partyId}')"><i class="fa-solid fa-right-left"></i></button>
        `;
        container.appendChild(newRow);
    }

    function removeCandidateRowFromParty(buttonElement, partyId) {
        buttonElement.closest('.candidate-row').remove();
        updateLegendaTotalVotes(partyId);
    }
    
    function migrateCandidateFromParty(buttonElement, fromPartyName) {
        const row = buttonElement.closest('.candidate-row');
        const nameInput = row.querySelector('input[type="text"]');
        const votesInput = row.querySelector('input[type="number"]');
        const growthInput = row.querySelector('input[type="number"][placeholder="% Cresc."]');
        const candidateName = nameInput.value;
        const candidateVotes = votesInput.value;
        const candidateGrowth = growthInput.value;

        showPartySelectModal(`Transferir <strong>${candidateName}</strong> para:`, fromPartyName, (toPartyName) => {
            if (!toPartyName) return;
            const fromPartyId = fromPartyName.replace(/[^a-zA-Z0-9]/g, '');
            const toPartyId = toPartyName.replace(/[^a-zA-Z0-9]/g, '');
            const toContainer = document.querySelector(`#legenda-accordion-${toPartyId} .candidate-list-container`);
            
            const newRow = document.createElement('div');
            newRow.className = 'grid grid-cols-12 items-center gap-2 mb-2 candidate-row';
            newRow.innerHTML = `
                <input type="text" placeholder="Nome" value="${candidateName}" class="col-span-5 bg-background p-2 rounded-lg border border-border">
                <input type="number" placeholder="Votos" value="${candidateVotes}" class="col-span-2 bg-background p-2 rounded-lg border border-border" oninput="updateProjectedVotesInEditor(this, '${toPartyId}')">
                <div class="col-span-3 flex items-center gap-2">
                    <input type="number" placeholder="% Cresc." value="${candidateGrowth}" class="w-24 bg-background p-2 rounded-lg border border-border text-right" oninput="updateProjectedVotesInEditor(this, '${toPartyId}')">
                    <span class="text-sm text-text-light">%</span>
                </div>
                <strong class="col-span-2 text-primary text-right projected-votes">${Math.floor(parseInt(candidateVotes) * (1 + parseFloat(candidateGrowth)/100)).toLocaleString('pt-BR')}</strong>
                <button class="bg-danger text-white px-3 py-2 rounded-lg" onclick="removeCandidateRowFromParty(this, '${toPartyId}')">&times;</button>
                <button class="bg-secondary text-white px-3 py-2 rounded-lg" title="Migrar" onclick="migrateCandidateFromParty(this, '${toPartyName}')"><i class="fa-solid fa-right-left"></i></button>
            `;
            toContainer.appendChild(newRow);
            row.remove();
            
            updateLegendaTotalVotes(fromPartyId);
            updateLegendaTotalVotes(toPartyId);

            showInfoModal(`${candidateName} movido para ${toPartyName}. Salve as alterações para aplicar.`);
        });
    }

    function saveAllLegendas() {
        baseScenario.partidos.forEach(party => {
            const partyId = party.nome.replace(/[^a-zA-Z0-9]/g, '');
            const container = document.getElementById(`legenda-accordion-${partyId}`);
            if (!container) return;

            const rows = container.querySelectorAll('.candidate-row');
            const newCandidatos = [];
            let totalVotes = 0;

            rows.forEach(row => {
                const name = row.querySelector('input[type="text"]').value.trim();
                const votes = parseInt(row.querySelector('input[type="number"]').value, 10) || 0;
                const growth = parseFloat(row.querySelector('input[type="number"][placeholder="% Cresc."]').value) / 100 || 0;
                
                if (name && votes > 0) {
                    newCandidatos.push({ nome: name, votos: votes, growth: growth });
                    totalVotes += Math.floor(votes * (1 + growth));
                }
            });

            newCandidatos.sort((a, b) => b.votos - a.votos);
            party.customCandidatos = newCandidatos;
            party.votosBase2022 = totalVotes;
            
            const boostInput = document.getElementById(`boost-${party.nome}`);
            if(boostInput) {
                boostInput.value = 0;
                boostInput.disabled = true;
                document.getElementById(`boost-value-${party.nome}`).textContent = '0%';
            }
        });

        showInfoModal('Todas as legendas foram salvas e aplicadas nas simulações!');
        updateScenario();
        initializeAnaliseTab(); // Refresh analysis with new data
    }

    function resetAllLegendas() {
        showConfirmationModal("Tem a certeza que quer restaurar todas as legendas para o padrão de 2022?", () => {
            baseScenario.partidos.forEach(p => {
                p.customCandidatos = null;
                p.votosBase2022 = DADOS_ELEICOES.SC.de.historico[0].partidos[p.nome].votos;
                const boostInput = document.getElementById(`boost-${p.nome}`);
                if (boostInput) boostInput.disabled = false;
            });
            initializeEditarLegendaTab();
            updateScenario();
            initializeAnaliseTab();
            showInfoModal("Todas as legendas foram restauradas.");
        });
    }


    // =================================================================================
    // CANDIDATE TAB LOGIC
    // =================================================================================
    function initializeCandidatosTab() {
        const container = document.getElementById('candidatos-accordion-container');
        container.innerHTML = '';

        baseScenario.partidos.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(party => {
            const color = PARTY_COLORS[party.nome] || '#64748b';
            const totalVotosPartido = party.candidatos.reduce((sum, cand) => sum + cand.votos, 0);
            
            let candidatesHtml = party.candidatos.map((cand, index) => `<div class="grid grid-cols-2 md:grid-cols-5 gap-4 p-3 border-t border-border candidate-row items-center" data-name="${cand.nome.toLowerCase()}"><div class="font-bold text-text-main col-span-2">${cand.nome} ${cand.isEleito ? '<i class="fa-solid fa-check-circle text-success text-xs"></i>' : ''}</div><div class="flex items-center gap-2 justify-end md:justify-start"><input type="number" value="${(cand.growth || 0) * 100}" oninput="updateCandidateGrowth('${party.nome}', ${index}, this.value)" class="w-20 bg-gray-900 p-1 rounded-lg border border-border text-right" placeholder="0"><span class="text-sm text-text-light">%</span></div><div class="text-text-light text-right"><strong class="text-main">${cand.votos.toLocaleString('pt-BR')}</strong><span class="hidden md:inline"> Votos Base</span></div><div class="text-text-light text-right"><strong class="text-primary" id="proj-votos-${party.nome.replace(/\s/g, '')}-${index}">${cand.votos.toLocaleString('pt-BR')}</strong><span class="hidden md:inline"> Votos Proj.</span></div></div>`).join('');

            const accordionItem = document.createElement('div');
            accordionItem.className = 'bg-gray-900/50 rounded-lg party-accordion-item';
            accordionItem.innerHTML = `<button class="w-full p-4 text-left font-bold flex justify-between items-center text-text-main" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('i').classList.toggle('rotate-180')"><div class="flex items-center"><div class="w-4 h-4 rounded-full mr-3" style="background-color: ${color}"></div><span>${party.nome}</span></div><div class="flex items-center"><span class="text-sm font-normal text-text-light mr-4">${party.candidatos.length} cands.</span><span class="text-sm font-normal text-text-light mr-4">Total: <strong class="text-main" id="total-legenda-${party.nome}">${totalVotosPartido.toLocaleString('pt-BR')}</strong></span><i class="fa-solid fa-chevron-down transition-transform"></i></div></button><div class="p-2 hidden"><div class="space-y-1">${candidatesHtml}</div></div>`;
            container.appendChild(accordionItem);
        });

        document.getElementById('candidato-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('.party-accordion-item').forEach(partyItem => {
                let partyVisible = false;
                partyItem.querySelectorAll('.candidate-row').forEach(row => {
                    const isVisible = row.dataset.name.includes(searchTerm);
                    row.style.display = isVisible ? 'grid' : 'none';
                    if (isVisible) partyVisible = true;
                });
                partyItem.style.display = partyVisible ? 'block' : 'none';
            });
        });
    }

    function updateCandidateGrowth(partyName, candidateIndex, growthValue) {
        const party = baseScenario.partidos.find(p => p.nome === partyName);
        if (!party) return;

        const candidate = party.candidatos[candidateIndex];
        candidate.growth = parseFloat(growthValue) / 100 || 0;

        const projectedVotes = Math.floor(candidate.votos * (1 + candidate.growth));
        document.getElementById(`proj-votos-${party.nome.replace(/\s/g, '')}-${candidateIndex}`).textContent = projectedVotes.toLocaleString('pt-BR');

        const newPartyTotal = party.candidatos.reduce((sum, cand) => sum + Math.floor(cand.votos * (1 + (cand.growth || 0))), 0);
        party.votosBase2022 = newPartyTotal;
        document.getElementById(`total-legenda-${party.nome}`).textContent = newPartyTotal.toLocaleString('pt-BR');

        updateScenario();
    }

    function changeTab(tabName) {
        ['simulador', 'candidatos', 'analise', 'eleitos2024', 'editarLegenda'].forEach(id => {
            document.getElementById(`content-${id}`).classList.toggle('hidden', id !== tabName);
        });
        document.querySelectorAll('#main-tabs button').forEach(button => {
            button.classList.remove('active', 'text-text-main');
            button.classList.add('text-text-light');
        });
        const activeButton = document.querySelector(`#main-tabs button[onclick="changeTab('${tabName}')"]`);
        activeButton.classList.add('active', 'text-text-main');
        activeButton.classList.remove('text-text-light');
        window.scrollTo(0, 0);
    }
    
    // =================================================================================
    // ANALYSIS TAB LOGIC
    // =================================================================================
    function initializeAnaliseTab() {
        initializePuxadoresAnalise();
        initializeEficienciaAnalise();
    }

    function initializePuxadoresAnalise() {
        const container = document.getElementById('analise-puxadores-container');
        container.innerHTML = '';

        baseScenario.partidos.filter(p => p.votosBase2022 > 0).sort((a, b) => b.votosBase2022 - a.votosBase2022).forEach(party => {
            const candidates = party.customCandidatos || party.candidatos;
            const top3 = candidates.slice(0, 3);
            const top3Votes = top3.reduce((sum, cand) => sum + cand.votos, 0);
            const partyTotalVotes = candidates.reduce((sum, cand) => sum + cand.votos, 0);
            const percentage = (partyTotalVotes > 0) ? (top3Votes / partyTotalVotes * 100).toFixed(1) : 0;
            
            let diagnosis = ''; let diagnosisColor = '';
            if (percentage >= 60) { diagnosis = 'Alta dependência dos puxadores.'; diagnosisColor = 'text-danger'; } 
            else if (percentage >= 40) { diagnosis = 'Concentração moderada.'; diagnosisColor = 'text-warning'; } 
            else { diagnosis = 'Votação bem distribuída.'; diagnosisColor = 'text-success'; }

            const card = document.createElement('div');
            card.className = 'bg-gray-900/50 p-4 rounded-lg border border-border flex flex-col';
            card.innerHTML = `<div class="flex items-center mb-3"><div class="w-4 h-4 rounded-full mr-3" style="background-color: ${PARTY_COLORS[party.nome] || '#64748b'}"></div><h3 class="font-bold text-lg text-text-main">${party.nome}</h3></div><ul class="text-sm space-y-2 flex-grow">${top3.map((cand, i) => `<li class="flex justify-between items-center"><span class="text-text-light truncate"><strong class="mr-2">${i+1}.</strong>${cand.nome}</span><div class="flex items-center"><span class="font-mono text-text-main mr-3">${cand.votos.toLocaleString('pt-BR')}</span></div></li>`).join('')}</ul><div class="mt-4 pt-4 border-t border-border"><div class="flex justify-between text-sm font-bold mb-1"><span>Concentração Top 3</span><span class="${diagnosisColor}">${percentage}%</span></div><div class="w-full bg-gray-700 rounded-full h-2.5"><div class="bg-gradient-to-r from-primary to-secondary h-2.5 rounded-full" style="width: ${percentage}%"></div></div><p class="text-xs text-center mt-2 ${diagnosisColor}">${diagnosis}</p></div>`;
            container.appendChild(card);
        });
    }

    function initializeEficienciaAnalise() {
        const container = document.getElementById('analise-eficiencia-container');
        container.innerHTML = '';
        const partidosComEleitos = baseScenario.partidos.map(party => {
            const candidates = party.customCandidatos || party.candidatos;
            const eleitos = candidates.filter(c => c.isEleito).length;
            const totalVotos = candidates.reduce((sum, cand) => sum + cand.votos, 0);
            return eleitos > 0 ? { nome: party.nome, custoPorCadeira: totalVotos / eleitos, totalVotos: totalVotos, totalEleitos: eleitos } : null;
        }).filter(p => p !== null).sort((a, b) => a.custoPorCadeira - b.custoPorCadeira);
        
        const maxCost = Math.max(...partidosComEleitos.map(p => p.custoPorCadeira));

        partidosComEleitos.forEach(party => {
            const barWidth = (party.custoPorCadeira / maxCost * 100);
            const item = document.createElement('div');
            item.className = 'bg-gray-900/50 p-3 rounded-lg';
            item.innerHTML = `<div class="flex flex-col sm:flex-row justify-between sm:items-center"><div class="flex items-center mb-2 sm:mb-0"><div class="w-4 h-4 rounded-full mr-3" style="background-color: ${PARTY_COLORS[party.nome] || '#64748b'}"></div><span class="font-bold">${party.nome}</span></div><div class="text-sm text-text-light">${party.totalEleitos} eleito(s) com ${party.totalVotos.toLocaleString('pt-BR')} votos</div></div><div class="mt-2"><div class="flex justify-between items-center text-xs text-text-light mb-1"><span>Custo por Cadeira</span><span class="font-bold text-lg text-primary">${Math.round(party.custoPorCadeira).toLocaleString('pt-BR')}</span></div><div class="w-full bg-gray-700 rounded-full h-4"><div class="bg-primary h-4 rounded-full" style="width: ${barWidth}%"></div></div></div>`;
            container.appendChild(item);
        });
    }

    function openTransferModal(sourcePartyName, candidateName) {
        const sourceParty = baseScenario.partidos.find(p => p.nome === sourcePartyName);
        const candidate = (sourceParty.customCandidatos || sourceParty.candidatos).find(c => c.nome === candidateName);
        
        showPartySelectModal(`Transferir <strong>${candidate.nome}</strong> de <strong>${sourcePartyName}</strong> para:`, sourcePartyName, (destinationPartyName) => {
             executeTransfer(sourcePartyName, candidateName, destinationPartyName);
        });
    }

    function executeTransfer(sourcePartyName, candidateName, destinationPartyName) {
        const sourceParty = baseScenario.partidos.find(p => p.nome === sourcePartyName);
        const destParty = baseScenario.partidos.find(p => p.nome === destinationPartyName);
        
        if (!sourceParty.customCandidatos) sourceParty.customCandidatos = JSON.parse(JSON.stringify(sourceParty.candidatos));
        if (!destParty.customCandidatos) destParty.customCandidatos = JSON.parse(JSON.stringify(destParty.candidatos));

        const candidateIndex = sourceParty.customCandidatos.findIndex(c => c.nome === candidateName);
        if (candidateIndex === -1) return;

        const [candidateToMove] = sourceParty.customCandidatos.splice(candidateIndex, 1);
        destParty.customCandidatos.push(candidateToMove);
        destParty.customCandidatos.sort((a,b) => b.votos - a.votos);

        sourceParty.votosBase2022 = sourceParty.customCandidatos.reduce((sum, cand) => sum + cand.votos, 0);
        destParty.votosBase2022 = destParty.customCandidatos.reduce((sum, cand) => sum + cand.votos, 0);
        
        [sourceParty, destParty].forEach(p => {
             const boostInput = document.getElementById(`boost-${p.nome}`);
             if(boostInput) boostInput.disabled = true;
        });

        closeModal();
        initializeAnaliseTab();
        updateScenario();
    }
    
    function resetAllData() {
        showConfirmationModal("Restaurar todos os dados para o padrão de 2022? As alterações serão perdidas.", () => {
            baseScenario = prepareBaseScenario();
            initializeControls();
            initializeCandidatosTab();
            initializeEditarLegendaTab();
            initializeAnaliseTab();
            updateScenario();
            showInfoModal("Todos os dados foram restaurados.");
        });
    }

    function showInfoModal(message) {
        showModal(`<div class="p-6 text-center"><p class="text-lg">${message}</p></div>`);
        setTimeout(closeModal, 2000);
    }

    function showConfirmationModal(message, onConfirm) {
        showModal(`<div class="p-6 text-text-light"><p class="text-lg mb-6 text-center">${message}</p><div class="flex justify-end space-x-4"><button onclick="closeModal()" class="bg-gray-700 hover:bg-gray-600 font-bold py-2 px-4 rounded-lg">Cancelar</button><button id="confirm-action-btn" class="bg-danger hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Confirmar</button></div></div>`);
        document.getElementById('confirm-action-btn').onclick = () => { onConfirm(); closeModal(); };
    }
    
    function showPartySelectModal(message, fromPartyName, onConfirm) {
        let optionsHtml = baseScenario.partidos
            .filter(p => p.nome !== fromPartyName)
            .map(p => `<option value="${p.nome}">${p.nome}</option>`)
            .join('');

        const modalHtml = `
            <div class="p-6 text-text-light">
                <p class="text-lg mb-4">${message}</p>
                <select id="party-select-input" class="w-full bg-gray-900 p-2 rounded-lg border border-border">
                    <option value="">Selecione um partido...</option>
                    ${optionsHtml}
                </select>
                <div class="flex justify-end space-x-4 mt-6">
                    <button onclick="closeModal()" class="bg-gray-700 hover:bg-gray-600 font-bold py-2 px-4 rounded-lg">Cancelar</button>
                    <button id="party-select-confirm-btn" class="bg-success hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg">Confirmar</button>
                </div>
            </div>
        `;
        showModal(modalHtml);
        const select = document.getElementById('party-select-input');
        document.getElementById('party-select-confirm-btn').onclick = () => {
            if (select.value) {
                onConfirm(select.value);
            }
        };
    }


    // =================================================================================
    // ELECTED IN 2024 TAB LOGIC
    // =================================================================================
    const cityStateMap = {
        // Paraná
        "BITURUNA": "PR", "GENERAL CARNEIRO": "PR", "PAULO FRONTIN": "PR",
        "AMPERE": "PR", "FRANCISCO BELTRÃO": "PR", "REALEZA": "PR",
        "CORONEL D. SOARES": "PR", "CORONEL VIVIDA": "PR", "MANGUEIRINHA": "PR",
        "SULINA": "PR", "ITAPEJARA DO OESTE": "PR", "BARRACÃO": "PR",
        "BELA VISTA DA CAROBA": "PR", "CAPANEMA": "PR", "FLOR DA SERRA DO SUL": "PR",
        "PLANALTO": "PR", "PRANCHITA": "PR", "STO ANTONIO DO SUDOESTE": "PR",
    };

    function getCityState(cityName) {
        return cityStateMap[cityName.toUpperCase()] || 'SC';
    }

    const ELEITOS_2024_DATA = {
        "1ª REGIÃO": [{"CIDADE": "ARMAZEM", "NOME CANDIDATO": "CENARIO MONTEIRO MARCELINO", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "374"}, {"CIDADE": "BRAÇO DO NORTE", "NOME CANDIDATO": "REGINALDO DEMÉTRIO", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "807"}, {"CIDADE": "GAROPABA", "NOME CANDIDATO": "JAIRO PEREIRA DOS SANTOS", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "1328"}, {"CIDADE": "IMBITUBA", "NOME CANDIDATO": "THIAGO ROSA", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "1065"}, {"CIDADE": "SANGÃO", "NOME CANDIDATO": "GENTIL TEIXEIRA SALVALAIO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "500"}, {"CIDADE": "SÃO LUDGERO", "NOME CANDIDATO": "LAUDY DA SILVA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "342"}],
        "2ª REGIÃO": [{"CIDADE": "BALN. CAMBORIU", "NOME CANDIDATO": "ASINIL MEDEIROS", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "1831"}, {"CIDADE": "BOMBINHAS", "NOME CANDIDATO": "LEANDRO GRACIA", "CARGO": "VEREADOR", "PARTIDO": "", "VOTOS": "662"}, {"CIDADE": "CAMBORIU", "NOME CANDIDATO": "JOSUÉ PEREIRA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "958"}, {"CIDADE": "CAMBORIU", "NOME CANDIDATO": "POLICIAL SILVIO WOLFF", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "1216"}, {"CIDADE": "CAMBORIU", "NOME CANDIDATO": "EWERSON UMBELINO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "760"}, {"CIDADE": "CAMBORIU", "NOME CANDIDATO": "IRMÃO MAYER", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "888"}, {"CIDADE": "FLORIANOPOLIS", "NOME CANDIDATO": "PR. GILIARD TORQUATO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "3675"}, {"CIDADE": "GOV. CELSO RAMOS", "NOME CANDIDATO": "PB. RAFAEL ZEFERINO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "427"}, {"CIDADE": "ITAPEMA", "NOME CANDIDATO": "IRMÃ RUTI", "CARGO": "VEREADORA", "PARTIDO": "REPU", "VOTOS": "754"}, {"CIDADE": "PALHOÇA", "NOME CANDIDATO": "MESTRE VANDERLEI", "CARGO": "VEREADOR", "PARTIDO": "", "VOTOS": "1143"}, {"CIDADE": "PAULO LOPES", "NOME CANDIDATO": "PRISCILA ROGÉRIO", "CARGO": "VEREADORA", "PARTIDO": "UNIÃO", "VOTOS": "215"}, {"CIDADE": "PAULO LOPES", "NOME CANDIDATO": "CELINHO", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "365"}, {"CIDADE": "PORTO BELO", "NOME CANDIDATO": "ALTINO JUNIOR", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "597"}, {"CIDADE": "PORTO BELO", "NOME CANDIDATO": "JOSIMAR JOSÉ", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "323"}, {"CIDADE": "PORTO BELO", "NOME CANDIDATO": "ONÉSIO RAMOS", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "715"}, {"CIDADE": "PORTO BELO", "NOME CANDIDATO": "AILTON NECKEL", "CARGO": "VICE PREFEITO", "PARTIDO": "MDB", "VOTOS": "10700"}, {"CIDADE": "SANTO AMARO DA IM", "NOME CANDIDATO": "JOAQUIM CUNHA", "CARGO": "VEREADOR", "PARTIDO": "", "VOTOS": "344"}, {"CIDADE": "SANTO AMARO DA IM", "NOME CANDIDATO": "ANDRÉ LUIZ AMARAL DAUFENBACH", "CARGO": "VEREADOR", "PARTIDO": "", "VOTOS": "286"}, {"CIDADE": "SÃO JOSÉ", "NOME CANDIDATO": "PR. ADAIR TESSARI", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "3176"}, {"CIDADE": "SÃO JOÃO BATISTA", "NOME CANDIDATO": "GUSTAVO GRIM", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "710"}],
        "3ª REGIÃO": [{"CIDADE": "ASCURRA", "NOME CANDIDATO": "MARCIO DA COSTA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "189"}, {"CIDADE": "BLUMENAU", "NOME CANDIDATO": "JOVINO CARDOSO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "4506"}, {"CIDADE": "BLUMENAU", "NOME CANDIDATO": "SILMARA MIGUEL", "CARGO": "VEREADORA", "PARTIDO": "PSD", "VOTOS": "4131"}, {"CIDADE": "BRUSQUE", "NOME CANDIDATO": "ANTÔNIO ROBERTO SILVA", "CARGO": "VEREADOR", "PARTIDO": "PRD", "VOTOS": "854"}, {"CIDADE": "DOUTOR PEDRINHO", "NOME CANDIDATO": "GELEADE GADIEL WOLLERT", "CARGO": "PREFEITO", "PARTIDO": "MDB", "VOTOS": "1183"}, {"CIDADE": "DOUTOR PEDRINHO", "NOME CANDIDATO": "ELIAS MARAFIGO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "113"}, {"CIDADE": "ILHOTA", "NOME CANDIDATO": "VANDERLEI COSTA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "570"}, {"CIDADE": "INDAIAL", "NOME CANDIDATO": "VALMIR JORDANI", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "1036"}, {"CIDADE": "ITAJAI", "NOME CANDIDATO": "ADÃO BITENCOURT", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "2165"}],
        "4ª REGIÃO": [{"CIDADE": "ARAQUARI", "NOME CANDIDATO": "AZEVEDO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "385"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "ADEMAR BORGES", "CARGO": "PREFEITO", "PARTIDO": "PSD", "VOTOS": "4345"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "RUAN CUNHA", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "478"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "WESLLEY FREITAS", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "447"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "JONATHAS LOPES", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "424"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "NELINHO BORGES", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "422"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "KEMPO", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "402"}, {"CIDADE": "BALN. BARRA DO SUL", "NOME CANDIDATO": "MARA", "CARGO": "VEREADORA", "PARTIDO": "PODEMO", "VOTOS": "341"}, {"CIDADE": "BALN. PIÇARRAS", "NOME CANDIDATO": "GLEBER SILVEIRA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "310"}, {"CIDADE": "BALN. PIÇARRAS", "NOME CANDIDATO": "ADRIANA LINHARES", "CARGO": "VEREADORA", "PARTIDO": "PSDB", "VOTOS": "615"}, {"CIDADE": "BARRA VELHA", "NOME CANDIDATO": "MARCIEL BERLIN", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "598"}, {"CIDADE": "BARRA VELHA", "NOME CANDIDATO": "CAIO PINHEIRO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "591"}, {"CIDADE": "CAMPO ALEGRE", "NOME CANDIDATO": "PROFESSOR ERNANI", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "446"}, {"CIDADE": "CORUPÁ", "NOME CANDIDATO": "ALAOR DUARTE JAE", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "225"}, {"CIDADE": "GARUVA", "NOME CANDIDATO": "KLAUS EDUARDO LENNETZ", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "767"}, {"CIDADE": "GUARAMIRIM", "NOME CANDIDATO": "EMERSON FLORES", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "657"}, {"CIDADE": "JARAGUA DO SUL", "NOME CANDIDATO": "ISRAEL CANI", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "2082"}, {"CIDADE": "JOINVILLE", "NOME CANDIDATO": "ADILSON GIRARDI", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "6447"}, {"CIDADE": "PENHA", "NOME CANDIDATO": "DC. LUIZINHO AMÉRICO", "CARGO": "PREFEITO", "PARTIDO": "PL", "VOTOS": "6200"}, {"CIDADE": "PENHA", "NOME CANDIDATO": "PB. MARIO MARQUETT", "CARGO": "VICE PREFEITO", "PARTIDO": "PL", "VOTOS": "6200"}, {"CIDADE": "PENHA", "NOME CANDIDATO": "EV. ADRIANO TIBECO", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "883"}, {"CIDADE": "SÃO FRANSCISCO DO", "NOME CANDIDATO": "SODA", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "680"}, {"CIDADE": "SÃO FRANSCISCO DO SMARYAN", "NOME CANDIDATO": "", "CARGO": "VEREADORA", "PARTIDO": "PL", "VOTOS": "556"}, {"CIDADE": "SÃO JOÃO DO ITAPERI", "NOME CANDIDATO": "OZEIAS ALVES", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "313"}, {"CIDADE": "SCHROEDER", "NOME CANDIDATO": "JAIR BRIDAROLI", "CARGO": "PREFEITO", "PARTIDO": "PL", "VOTOS": "3816"}],
        "5ª REGIÃO": [{"CIDADE": "FREI ROGÉRIO", "NOME CANDIDATO": "PB. VORLI SCHAFFER", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "93"}, {"CIDADE": "LAGES", "NOME CANDIDATO": "GABRIEL CÓRDOVA", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "2060"}, {"CIDADE": "SANTA CECILIA", "NOME CANDIDATO": "PB. JOSIAS RODRIGUES", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "250"}, {"CIDADE": "SÃO CRISTÓVÃO", "NOME CANDIDATO": "PB. JOÃO PAULO GROBE", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "218"}, {"CIDADE": "SÃO CRISTÓVÃO", "NOME CANDIDATO": "PB. RAFAEL BRANCO", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "143"}, {"CIDADE": "SÃO JOAQUIM", "NOME CANDIDATO": "PR. SEBASTIÃO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "596"}],
        "6ª REGIÃO": [{"CIDADE": "BITURUNA", "NOME CANDIDATO": "CLEITON DE BASTIANI", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "367"}, {"CIDADE": "GENERAL CARNEIRO", "NOME CANDIDATO": "JOARILSO", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "305"}, {"CIDADE": "MAFRA", "NOME CANDIDATO": "DIRCILENE DITRICH PIΝΤΟ", "CARGO": "VEREADORA", "PARTIDO": "REPU", "VOTOS": "742"}, {"CIDADE": "PAPANDUVA", "NOME CANDIDATO": "MARLI DE LUCA", "CARGO": "VEREADORA", "PARTIDO": "PP", "VOTOS": "562"}, {"CIDADE": "PAULO FRONTIN", "NOME CANDIDATO": "JAIRO BERTUSSI", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "137"}, {"CIDADE": "PAULO FRONTIN", "NOME CANDIDATO": "MELQUIZEDEKE VERISSIMO", "CARGO": "VEREADOR", "PARTIDO": "PMB", "VOTOS": "165"}, {"CIDADE": "PAULO FRONTIN", "NOME CANDIDATO": "SEBASTIÃO DA SILVA", "CARGO": "VICE-PREFEITO", "PARTIDO": "PSD", "VOTOS": "1720"}],
        "7ª REGIÃO": [{"CIDADE": "CORONEL FREITAS", "NOME CANDIDATO": "EDILVO BAGIO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "491"}, {"CIDADE": "LAGEADO GRANDE", "NOME CANDIDATO": "EVANDRO DE OLIVEIRA", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "62"}, {"CIDADE": "PALMITOS", "NOME CANDIDATO": "RODEMAR LEOCIR KUSSLER", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "614"}, {"CIDADE": "PAIAL", "NOME CANDIDATO": "JOSEMAR REIS DA SILVA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "105"}],
        "8ª REGIÃO": [{"CIDADE": "AMPERE", "NOME CANDIDATO": "PROFESSOR IRIO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "567"}, {"CIDADE": "FRANCISCO BELTRÃO", "NOME CANDIDATO": "PEDRO TUFÃO FILHO", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "1364"}, {"CIDADE": "REALEZA", "NOME CANDIDATO": "OZEIAS", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "320"}],
        "9ª REGIÃO": [{"CIDADE": "CATANDUVAS", "NOME CANDIDATO": "MONA", "CARGO": "PREFEITA", "PARTIDO": "PL", "VOTOS": "3479"}, {"CIDADE": "CATANDUVAS", "NOME CANDIDATO": "PB. ANTONΝΙΟ", "CARGO": "VICE PREFEITO", "PARTIDO": "PL", "VOTOS": "3479"}, {"CIDADE": "CAPINZAL", "NOME CANDIDATO": "FRANCISCO SUTIL", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "580"}, {"CIDADE": "ERVAL VELHO", "NOME CANDIDATO": "JULIANO OLIVEIRA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "198"}, {"CIDADE": "JOAÇABA", "NOME CANDIDATO": "LUIZ VASTRES", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "483"}, {"CIDADE": "PRES. CASTELLO BRANCO", "NOME CANDIDATO": "CLEUSIR WOLF", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "71"}, {"CIDADE": "VARGEM BONITA", "NOME CANDIDATO": "PR. OSCAR SALVADOR", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "160"}],
        "10ª REGIÃO": [{"CIDADE": "ARARANGUÁ", "NOME CANDIDATO": "PEDRO PAULO DE SOUZA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "1373"}, {"CIDADE": "ARARANGUÁ", "NOME CANDIDATO": "NELSON SOARES", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "1210"}, {"CIDADE": "ARARANGUÁ", "NOME CANDIDATO": "JOSÉ CARLOS DOS SANTOS", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "1031"}, {"CIDADE": "BALN. GAIVOTA", "NOME CANDIDATO": "DC. PAULO ROBERTO", "CARGO": "VEREADOR", "PARTIDO": "PRD", "VOTOS": "260"}, {"CIDADE": "BALN. RINCÃO", "NOME CANDIDATO": "PB. ROGERIO CARDOSO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "751"}, {"CIDADE": "BALN. RINCÃO", "NOME CANDIDATO": "PB. AYRTON FERREIRA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "503"}, {"CIDADE": "BALN. RINCÃO", "NOME CANDIDATO": "EV. JUNIOR MOTA", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "349"}, {"CIDADE": "COCAL DO SUL", "NOME CANDIDATO": "DC. JULIO FOGAÇA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "411"}, {"CIDADE": "CRICIUMA", "NOME CANDIDATO": "PR. OBADIAS BENONES", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "2777"}, {"CIDADE": "CRICIUMA", "NOME CANDIDATO": "AX. AMARAL BITTENCOURT", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "2136"}, {"CIDADE": "CRICIUMA", "NOME CANDIDATO": "EV. NERI XAVIER", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "1460"}, {"CIDADE": "ERMO", "NOME CANDIDATO": "PB. DANIEL BORGES", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "185"}, {"CIDADE": "ERMO", "NOME CANDIDATO": "DC. JEAN", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "98"}, {"CIDADE": "FORQUILHINHA", "NOME CANDIDATO": "GRAZI CRAVO", "CARGO": "VEREADORA", "PARTIDO": "UNIÃO", "VOTOS": "766"}, {"CIDADE": "JACINTO MACHADO", "NOME CANDIDATO": "ADERVAL DA ROSA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "547"}, {"CIDADE": "JACINTO MACHADO", "NOME CANDIDATO": "ENISON RECCO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "418"}, {"CIDADE": "LAURO MULLER", "NOME CANDIDATO": "PB. LINDOMAR CATAΝΕΟ", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "545"}, {"CIDADE": "MORRO DA FUMAÇA", "NOME CANDIDATO": "JORGIA GUGLIELMI", "CARGO": "VEREADORA", "PARTIDO": "PL", "VOTOS": "824"}, {"CIDADE": "SANTA ROSA DO SUL", "NOME CANDIDATO": "VALÉRIO COLOMBO", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "263"}, {"CIDADE": "URUSSANGA", "NOME CANDIDATO": "IVAN VIEIRA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "710"}],
        "11ª REGIÃO": [{"CIDADE": "CORONEL D. SOARES", "NOME CANDIDATO": "FERNANDO M. S. DA ROSA", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "228"}, {"CIDADE": "CORONEL VIVIDA", "NOME CANDIDATO": "FABIO DANIEL", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "473"}, {"CIDADE": "MANGUEIRINHA", "NOME CANDIDATO": "JOÃO DOS SANTOS", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "229"}, {"CIDADE": "SULINA", "NOME CANDIDATO": "LINDOMAR GASPAR", "CARGO": "VEREADOR", "PARTIDO": "PSB", "VOTOS": "158"}, {"CIDADE": "ITAPEJARA DO OESTE", "NOME CANDIDATO": "MARCIO", "CARGO": "VICE-PREFEITO", "PARTIDO": "PL", "VOTOS": "4428"}],
        "12ª REGIÃO": [{"CIDADE": "BRUNÓPOLIS", "NOME CANDIDATO": "SIRLEI DE SOUZA", "CARGO": "VEREADORA", "PARTIDO": "MDB", "VOTOS": "160"}, {"CIDADE": "BRUNÓPOLIS", "NOME CANDIDATO": "ADILSON SOUZA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "121"}, {"CIDADE": "FRAIBURGO", "NOME CANDIDATO": "LUIZ RIEGERT", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "750"}, {"CIDADE": "FRAIBURGO", "NOME CANDIDATO": "DAVI FERNANDES", "CARGO": "VEREADOR", "PARTIDO": "PODEMO", "VOTOS": "538"}, {"CIDADE": "LEBON REGIS", "NOME CANDIDATO": "MOACIR MACUCO", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "201"}, {"CIDADE": "MONTE CARLO", "NOME CANDIDATO": "CARLINHOS", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "282"}, {"CIDADE": "SALTO VELOSO", "NOME CANDIDATO": "DIRCEU PERÃO", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "309"}, {"CIDADE": "TIMBO GRANDE", "NOME CANDIDATO": "CLAUDIONOR MATOSO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "244"}, {"CIDADE": "TIMBO GRANDE", "NOME CANDIDATO": "JUSSARA GUEDES", "CARGO": "VEREADORA", "PARTIDO": "PL", "VOTOS": "184"}, {"CIDADE": "TIMBO GRANDE", "NOME CANDIDATO": "ARI JOSÉ GALESKI", "CARGO": "PREFEITO", "PARTIDO": "UNIÃO", "VOTOS": "2121"}],
        "13ª REGIÃO": [{"CIDADE": "AGROLANDIA", "NOME CANDIDATO": "TATIANE SILVA", "CARGO": "VEREADORA", "PARTIDO": "MDB", "VOTOS": "317"}, {"CIDADE": "SALETE", "NOME CANDIDATO": "RICARDO PAGEL", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "488"}, {"CIDADE": "SALETE", "NOME CANDIDATO": "EDUARDO SCHUMBEDLER", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "304"}, {"CIDADE": "SALETE", "NOME CANDIDATO": "TAFINHA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "290"}, {"CIDADE": "SALETE", "NOME CANDIDATO": "ROBERTO LOCH", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "251"}, {"CIDADE": "POUSO REDONDO", "NOME CANDIDATO": "GEZIEL SARDÁ", "CARGO": "VEREADOR", "PARTIDO": "PRD", "VOTOS": "492"}],
        "14ª REGIÃO": [{"CIDADE": "BANDEIRANTES", "NOME CANDIDATO": "CARMEN MACHADO", "CARGO": "VEREADORA", "PARTIDO": "PSB", "VOTOS": "114"}, {"CIDADE": "GUARUJA DO SUL", "NOME CANDIDATO": "FABRICIO WAGNER", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "183"}, {"CIDADE": "PARAISO", "NOME CANDIDATO": "ADEMIR VICHINIESKI", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "136"}, {"CIDADE": "RIQUEZA", "NOME CANDIDATO": "RONI GURKE", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "174"}, {"CIDADE": "RIQUEZA", "NOME CANDIDATO": "JULIANO BORTOLANZA", "CARGO": "PREFEITO", "PARTIDO": "MDB", "VOTOS": "1888"}, {"CIDADE": "ROMELÂNDIA", "NOME CANDIDATO": "ESMAEL BARPP", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "282"}, {"CIDADE": "SÃO JOSE DO CEDRO", "NOME CANDIDATO": "AX. ENIO CORROSSI", "CARGO": "VICE PREFEITO", "PARTIDO": "UNIÃO", "VOTOS": "4124"}],
        "15ª REGIÃO": [{"CIDADE": "BOM JESUS", "NOME CANDIDATO": "DC. EMANUEL", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "105"}, {"CIDADE": "FAXINAL DOS GUEDES", "NOME CANDIDATO": "PB VALDEMIR NEVES", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "489"}, {"CIDADE": "FAXINAL DOS GUEDES", "NOME CANDIDATO": "MÁRCIO LUIZ DE LIMA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "415"}, {"CIDADE": "OURO VERDE", "NOME CANDIDATO": "GENI BIOTTO", "CARGO": "VEREADORA", "PARTIDO": "PL", "VOTOS": "106"}, {"CIDADE": "XANXERÊ", "NOME CANDIDATO": "PB. VINICIUS CRENONINI", "CARGO": "VEREADOR", "PARTIDO": "PSDB", "VOTOS": "1193"}, {"CIDADE": "XANXERÊ", "NOME CANDIDATO": "DAVI PINTO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "936"}],
        "16ª REGIÃO": [{"CIDADE": "BARRACÃO", "NOME CANDIDATO": "RAUL PAZ BRIZOLLA", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "249"}, {"CIDADE": "BELA VISTA DA CAROBA", "NOME CANDIDATO": "JOSE VALDIR RODRIGUES", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "127"}, {"CIDADE": "BOM JESUS DO SUL", "NOME CANDIDATO": "JULIO DE MOURA", "CARGO": "VEREADOR", "PARTIDO": "UNIÃO", "VOTOS": "218"}, {"CIDADE": "CAPANEMA", "NOME CANDIDATO": "EDSON WILMSEN", "CARGO": "VEREADOR", "PARTIDO": "PDT", "VOTOS": "503"}, {"CIDADE": "FLOR DA SERRA DO SUL", "NOME CANDIDATO": "VANDERLEI CHORNA", "CARGO": "VEREADOR", "PARTIDO": "PODEMO", "VOTOS": "298"}, {"CIDADE": "FLOR DA SERRA DO SUL", "NOME CANDIDATO": "DECIO LUBACHEVISKI", "CARGO": "VEREADOR", "PARTIDO": "PODEMO", "VOTOS": "306"}, {"CIDADE": "PLANALTO", "NOME CANDIDATO": "FABIO SCHIRMANN", "CARGO": "VEREADOR", "PARTIDO": "REPU", "VOTOS": "344"}, {"CIDADE": "PRANCHITA", "NOME CANDIDATO": "DANIEL DE SOUZA DA LUZ", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "252"}, {"CIDADE": "STO ANTONIO DO SUDOESTE", "NOME CANDIDATO": "VANDERLEI NOVAKI", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "921"}, {"CIDADE": "STO ANTONIO DO SUDOESTE", "NOME CANDIDATO": "VALDIR ANTONIO CARVALHO", "CARGO": "VEREADOR", "PARTIDO": "PSD", "VOTOS": "559"}, {"CIDADE": "STO ANTONIO DO SUDOESTE", "NOME CANDIDATO": "RICARDO ORTINA", "CARGO": "PREFEITO", "PARTIDO": "PL", "VOTOS": "10352"}],
        "17ª REGIÃO": [{"CIDADE": "CORONEL MARTINS", "NOME CANDIDATO": "DAVI DUTRA", "CARGO": "VEREADOR", "PARTIDO": "PSB", "VOTOS": "50"}, {"CIDADE": "ENTRE RIOS", "NOME CANDIDATO": "EVANDRO", "CARGO": "PREFEITO", "PARTIDO": "PL", "VOTOS": "1497"}, {"CIDADE": "ENTRE RIOS", "NOME CANDIDATO": "ELIAS ARRUDA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "209"}, {"CIDADE": "ENTRE RIOS", "NOME CANDIDATO": "PAULO FIGUEIRA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "127"}, {"CIDADE": "ENTRE RIOS", "NOME CANDIDATO": "ESTEVÃO MARTINS", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "128"}, {"CIDADE": "JARDINÓPOLIS", "NOME CANDIDATO": "NEI LIMA", "CARGO": "VICE PREFEITO", "PARTIDO": "PP", "VOTOS": "1100"}, {"CIDADE": "JARDINÓPOLIS", "NOME CANDIDATO": "PABLO MAXSUEL", "CARGO": "VEREADOR", "PARTIDO": "PT", "VOTOS": "95"}, {"CIDADE": "JUPIÁ", "NOME CANDIDATO": "SAMUEL TRENTO", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "124"}, {"CIDADE": "QUILOMBO", "NOME CANDIDATO": "LEONEL AFONSO DE SOUZA", "CARGO": "VEREADOR", "PARTIDO": "MDB", "VOTOS": "319"}, {"CIDADE": "QUILOMBO", "NOME CANDIDATO": "EDIANE RAMOS", "CARGO": "VEREADORA", "PARTIDO": "PP", "VOTOS": "347"}, {"CIDADE": "SALTINHO", "NOME CANDIDATO": "PB. LAURI GONÇALVES", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "136"}, {"CIDADE": "SÃO DOMINGOS", "NOME CANDIDATO": "EDSON BRUNETO", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "266"}, {"CIDADE": "SUL BRASIL", "NOME CANDIDATO": "FABIANE PESENATO GOTZ", "CARGO": "VEREADORA", "PARTIDO": "PP", "VOTOS": "223"}],
        "18ª REGIÃO": [{"CIDADE": "IBIRAMA", "NOME CANDIDATO": "GUIDO PENZ", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "243"}, {"CIDADE": "IBIRAMA", "NOME CANDIDATO": "JORGE ELI DE OLIVEIRA", "CARGO": "VEREADOR", "PARTIDO": "PL", "VOTOS": "419"}, {"CIDADE": "LEOBERTO LEAL", "NOME CANDIDATO": "JULIANA FRANZEN", "CARGO": "VEREADORA", "PARTIDO": "PL", "VOTOS": "135"}, {"CIDADE": "PRESIDENTE GETULIO", "NOME CANDIDATO": "ALEXANDRE DA SILVA", "CARGO": "VEREADOR", "PARTIDO": "PP", "VOTOS": "416"}, {"CIDADE": "VITOR MEIRELLES", "NOME CANDIDATO": "PB. MARCELO DAROLT", "CARGO": "PREFEITO", "PARTIDO": "PL", "VOTOS": "2185"}]
    };

    let mapData = null; // To store the loaded TopoJSON data

    async function initializeEleitos2024Tab() {
        totalSupportVotes = 0; // Reset on tab initialization
        const container = document.getElementById('eleitos-2024-container');
        const select = document.getElementById('region-select');
        container.innerHTML = '';
        select.innerHTML = '<option value="all">Todas as Regiões</option>';
        
        const allRegionCities = {};

        Object.keys(ELEITOS_2024_DATA).forEach(region => {
            select.innerHTML += `<option value="${region}">${region}</option>`;
            allRegionCities[region] = new Set();
            ELEITOS_2024_DATA[region].forEach(cand => {
                allRegionCities[region].add(cand.CIDADE);
            });
        });
        
        updateEleitosSummary('all');

        Object.keys(ELEITOS_2024_DATA).forEach((region, regionIndex) => {
            const regionData = ELEITOS_2024_DATA[region];
            let tableRows = regionData.map((cand, candIndex) => {
                const uniqueId = `support-check-${regionIndex}-${candIndex}`;
                const state = getCityState(cand.CIDADE);
                return `
                <tr class="border-b border-border" data-party="${cand.PARTIDO || 'N/A'}">
                    <td class="py-3 px-4">${cand.CIDADE} (${state})</td>
                    <td class="py-3 px-4">${cand["NOME CANDIDATO"]}</td>
                    <td class="py-3 px-4">${cand.CARGO}</td>
                    <td class="py-3 px-4">${cand.PARTIDO || 'N/A'}</td>
                    <td class="py-3 px-4 text-right">${cand.VOTOS}</td>
                    <td class="py-3 px-4 text-center">
                        <input type="checkbox" id="${uniqueId}" class="h-5 w-5 bg-gray-700 border-border rounded text-primary focus:ring-primary shadow-lg" onchange="recalculateTotalSupportVotes()">
                    </td>
                </tr>
            `}).join('');

            container.innerHTML += `
                <div class="region-table" id="region-${region.replace(/[^a-zA-Z0-9]/g, '')}">
                    <h3 class="text-xl font-bold text-secondary mt-8 mb-2">${region}</h3>
                    <p class="text-xs text-text-light mb-3 italic">Cidades: ${[...allRegionCities[region]].join(', ')}</p>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-900/50">
                                <tr>
                                    <th class="py-3 px-4">Cidade</th>
                                    <th class="py-3 px-4">Nome</th>
                                    <th class="py-3 px-4">Cargo</th>
                                    <th class="py-3 px-4">Partido</th>
                                    <th class="py-3 px-4 text-right">Votos</th>
                                    <th class="py-3 px-4 text-center">
                                        <div class="flex items-center justify-center gap-2">
                                            Apoio
                                            <input type="checkbox" title="Selecionar Todos na Região" class="h-5 w-5 bg-gray-700 border-border rounded text-primary focus:ring-primary shadow-lg" onchange="toggleAllSupport(this, '${region}')">
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>${tableRows}</tbody>
                        </table>
                    </div>
                </div>
            `;
        });
        
        // Load and draw the map
        try {
            mapData = await d3.json("https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-42-mun.json");
            drawMap('all');
        } catch (error) {
            console.error("Error loading map data:", error);
            document.getElementById('map-container').innerHTML = `<p class="text-center text-danger p-4">Erro ao carregar o mapa.</p>`;
        }
    }

    function recalculateTotalSupportVotes() {
        totalSupportVotes = 0;
        const allCheckedBoxes = document.querySelectorAll('#eleitos-2024-container tbody input[type="checkbox"]:checked');
        
        allCheckedBoxes.forEach(checkbox => {
            const row = checkbox.closest('tr');
            if (row) {
                // The vote count is in the 5th cell (index 4)
                const votesText = row.children[4].textContent;
                const voteValue = parseInt(votesText.replace(/\./g, ''), 10) || 0;
                totalSupportVotes += voteValue * 0.25;
            }
        });

        const summaryElement = document.getElementById('summary-support-votes');
        if (summaryElement) {
            summaryElement.textContent = Math.round(totalSupportVotes).toLocaleString('pt-BR');
        }
    }
    
    function toggleAllSupport(headerCheckbox, region) {
        const isChecked = headerCheckbox.checked;
        const table = document.getElementById(`region-${region.replace(/[^a-zA-Z0-9]/g, '')}`);
        if (table) {
            const candidateCheckboxes = table.querySelectorAll('tbody input[type="checkbox"]');
            candidateCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
        }
        recalculateTotalSupportVotes();
    }


    function updateEleitosSummary(region) {
        const summaryContainer = document.getElementById('eleitos-2024-summary');
        let summary = { cargos: {}, partidos: {}, generos: { homens: 0, mulheres: 0 } };
        const regionsToProcess = region === 'all' ? Object.keys(ELEITOS_2024_DATA) : [region];

        regionsToProcess.forEach(regionKey => {
            const regionData = ELEITOS_2024_DATA[regionKey];
            if (!regionData) return;
            regionData.forEach(cand => {
                let cargo = cand.CARGO.toUpperCase().replace('-', ' ');
                if (cargo.endsWith('A')) cargo = cargo.slice(0, -1) + 'OR';
                summary.cargos[cargo] = (summary.cargos[cargo] || 0) + 1;
                const partido = cand.PARTIDO || 'N/A';
                summary.partidos[partido] = (summary.partidos[partido] || 0) + 1;
                if (cand.CARGO.toUpperCase().endsWith('A')) summary.generos.mulheres++;
                else summary.generos.homens++;
            });
        });

        const sortedPartidos = Object.entries(summary.partidos).sort(([,a],[,b]) => b-a);
        summaryContainer.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
            <div class="bg-background p-3 rounded-lg text-center clickable" onclick="showSummaryModal('CARGO', 'PREFEITO', '${region}')"><p class="text-xs font-semibold text-text-light uppercase">Prefeitos</p><p class="text-2xl font-bold text-primary">${summary.cargos['PREFEITO'] || 0}</p></div>
            <div class="bg-background p-3 rounded-lg text-center clickable" onclick="showSummaryModal('CARGO', 'VICE PREFEITO', '${region}')"><p class="text-xs font-semibold text-text-light uppercase">Vice-Prefeitos</p><p class="text-2xl font-bold text-primary">${summary.cargos['VICE PREFEITO'] || 0}</p></div>
            <div class="bg-background p-3 rounded-lg text-center clickable" onclick="showSummaryModal('CARGO', 'VEREADOR', '${region}')"><p class="text-xs font-semibold text-text-light uppercase">Vereadores</p><p class="text-2xl font-bold text-primary">${summary.cargos['VEREADOR'] || 0}</p></div>
            <div class="bg-background p-3 rounded-lg text-center clickable" onclick="showSummaryModal('GENERO', 'HOMEM', '${region}')"><p class="text-xs font-semibold text-text-light uppercase">Homens</p><p class="text-2xl font-bold text-blue-400">${summary.generos.homens}</p></div>
            <div class="bg-background p-3 rounded-lg text-center clickable" onclick="showSummaryModal('GENERO', 'MULHER', '${region}')"><p class="text-xs font-semibold text-text-light uppercase">Mulheres</p><p class="text-2xl font-bold text-pink-400">${summary.generos.mulheres}</p></div>
            <div class="bg-background p-3 rounded-lg text-center"><p class="text-xs font-semibold text-text-light uppercase">Estimativa de Votos</p><p id="summary-support-votes" class="text-2xl font-bold text-secondary">${Math.round(totalSupportVotes).toLocaleString('pt-BR')}</p></div>
        </div>
        <div>
            <h3 class="text-lg font-bold text-secondary mb-3">Eleitos por Partido</h3>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 text-sm">
                ${sortedPartidos.map(([partido, total]) => `<div class="bg-background p-2 rounded-lg flex justify-between items-center clickable" onclick="showPartySupportModal('${partido}', '${region}')"><span class="font-bold">${partido}</span><span class="font-mono text-primary font-semibold">${total}</span></div>`).join('')}
            </div>
        </div>`;
    }

    function filterEleitosByRegion(region) {
        initializeEleitos2024Tab().then(() => {
            updateEleitosSummary(region);
            drawMap(region);
            document.querySelectorAll('.region-table').forEach(table => {
                table.style.display = (region === 'all' || table.id === `region-${region.replace(/[^a-zA-Z0-9]/g, '')}`) ? 'block' : 'none';
            });
            document.getElementById('region-select').value = region;
            recalculateTotalSupportVotes(); 
        });
    }
    
    function drawMap(region) {
        if (!mapData) return;

        const container = d3.select("#map-container");
        container.select("svg").remove();

        const width = container.node().getBoundingClientRect().width;
        const height = width * 0.6;

        const svg = container.append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", `0 0 ${width} ${height}`);

        const tooltip = d3.select("#map-tooltip");
        const projection = d3.geoMercator().fitSize([width, height], mapData);
        const path = d3.geoPath().projection(projection);

        const electedCitiesData = {};
        Object.values(ELEITOS_2024_DATA).flat().forEach(e => {
            const city = e.CIDADE.toUpperCase();
            if (!electedCitiesData[city]) electedCitiesData[city] = { parties: {} };
            const party = e.PARTIDO || 'N/A';
            electedCitiesData[city].parties[party] = (electedCitiesData[city].parties[party] || 0) + 1;
        });

        Object.keys(electedCitiesData).forEach(city => {
            const parties = electedCitiesData[city].parties;
            const topParty = Object.keys(parties).reduce((a, b) => parties[a] > parties[b] ? a : b, 'N/A');
            electedCitiesData[city].topParty = topParty;
        });
        
        const citiesInRegion = region === 'all' 
            ? new Set(Object.keys(electedCitiesData)) 
            : new Set(ELEITOS_2024_DATA[region] ? ELEITOS_2024_DATA[region].map(c => c.CIDADE.toUpperCase()) : []);

        svg.selectAll("path")
            .data(mapData.features)
            .enter().append("path")
            .attr("d", path)
            .attr("class", "municipio")
            .attr("fill", d => {
                const cityName = d.properties.name.toUpperCase();
                if (citiesInRegion.has(cityName) && electedCitiesData[cityName]) {
                    const cityData = electedCitiesData[cityName];
                    return PARTY_COLORS[cityData.topParty] || '#f97316';
                }
                return '#1e2937'; // Use card color for non-highlighted cities for better visibility
            })
            .style("cursor", d => citiesInRegion.has(d.properties.name.toUpperCase()) ? "pointer" : "default")
            .on("mouseover", function(event, d) {
                const cityName = d.properties.name;
                if (citiesInRegion.has(cityName.toUpperCase())) {
                    d3.select(this).classed("highlight", true);
                    tooltip.style("opacity", 1)
                           .html(cityName)
                           .style("left", (event.pageX + 10) + "px")
                           .style("top", (event.pageY - 28) + "px");
                }
            })
            .on("mouseout", function() {
                d3.select(this).classed("highlight", false);
                tooltip.style("opacity", 0);
            })
            .on("click", function(event, d) {
                const cityName = d.properties.name.toUpperCase();
                if (citiesInRegion.has(cityName)) {
                    showCityModal(d.properties.name);
                }
            });
    }

    function showCityModal(cityName) {
        const upperCityName = cityName.toUpperCase();
        const cityData = [];
        for (const region in ELEITOS_2024_DATA) {
            ELEITOS_2024_DATA[region].forEach(candidate => {
                if (candidate.CIDADE.toUpperCase() === upperCityName) {
                    cityData.push(candidate);
                }
            });
        }

        if (cityData.length === 0) return;

        let candidatesHtml = cityData.map(cand => {
            const state = getCityState(cand.CIDADE);
            return `
            <tr class="border-b border-border hover:bg-background">
                <td class="py-3 px-4">${cand.CIDADE} (${state})</td>
                <td class="py-3 px-4">${cand["NOME CANDIDATO"]}</td>
                <td class="py-3 px-4">${cand.CARGO}</td>
                <td class="py-3 px-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${PARTY_COLORS[cand.PARTIDO] || '#64748b'}"></div>
                        <span>${cand.PARTIDO || 'N/A'}</span>
                    </div>
                </td>
                <td class="py-3 px-4 text-right font-mono">${cand.VOTOS}</td>
            </tr>
        `}).join('');

        const modalHtml = `
            <div class="p-6 text-text-light">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-secondary">${cityName}</h2>
                        <p>Eleitos em 2024</p>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-900/50">
                            <tr>
                                <th class="py-3 px-4">Cidade</th>
                                <th class="py-3 px-4">Nome</th>
                                <th class="py-3 px-4">Cargo</th>
                                <th class="py-3 px-4">Partido</th>
                                <th class="py-3 px-4 text-right">Votos</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${candidatesHtml}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        showModal(modalHtml);
    }
    
    function showPartySupportModal(partyName, region) {
        const modalHtml = `
            <div class="p-6 text-text-light">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-secondary">Gerir Apoio - ${partyName}</h2>
                        <p>Região: ${region === 'all' ? 'Todas' : region}</p>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>
                <div class="space-y-4">
                    <button class="w-full bg-success text-white font-bold py-3 rounded-lg" onclick="togglePartySupport('${partyName}', '${region}', true)">Apoiar Todos do Partido</button>
                    <button class="w-full bg-danger text-white font-bold py-3 rounded-lg" onclick="togglePartySupport('${partyName}', '${region}', false)">Remover Apoio de Todos</button>
                </div>
            </div>
        `;
        showModal(modalHtml);
    }

    function togglePartySupport(partyName, region, shouldSupport) {
        const regionsToProcess = region === 'all' ? Object.keys(ELEITOS_2024_DATA) : [region];
        
        regionsToProcess.forEach(regionKey => {
            const table = document.getElementById(`region-${regionKey.replace(/[^a-zA-Z0-9]/g, '')}`);
            if (table) {
                const candidateRows = table.querySelectorAll(`tbody tr[data-party="${partyName}"]`);
                candidateRows.forEach(row => {
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    if (checkbox) checkbox.checked = shouldSupport;
                });
            }
        });
        
        recalculateTotalSupportVotes();
        closeModal();
    }

    function showSummaryModal(filterType, filterValue, region) {
        const regionsToProcess = region === 'all' ? Object.keys(ELEITOS_2024_DATA) : [region];
        let filteredData = [];

        regionsToProcess.forEach(regionKey => {
            const regionData = ELEITOS_2024_DATA[regionKey];
            if (!regionData) return;

            regionData.forEach(candidate => {
                let match = false;
                if (filterType === 'CARGO') {
                    let cargo = candidate.CARGO.toUpperCase().replace('-', ' ');
                    if (cargo.endsWith('A')) cargo = cargo.slice(0, -1) + 'OR';
                    if (cargo === filterValue.toUpperCase()) {
                        match = true;
                    }
                } else if (filterType === 'PARTIDO') {
                    const party = candidate.PARTIDO || 'N/A';
                    if (party.toUpperCase() === filterValue.toUpperCase()) {
                        match = true;
                    }
                } else if (filterType === 'GENERO') {
                    const isMulher = candidate.CARGO.toUpperCase().endsWith('A');
                    if (filterValue === 'MULHER' && isMulher) {
                        match = true;
                    } else if (filterValue === 'HOMEM' && !isMulher) {
                        match = true;
                    }
                }
                
                if (match) {
                    filteredData.push(candidate);
                }
            });
        });

        if (filteredData.length === 0) {
            showInfoModal(`Nenhum resultado encontrado para "${filterValue}" na região selecionada.`);
            return;
        }
        
        filteredData.sort((a, b) => a.CIDADE.localeCompare(b.CIDADE) || a['NOME CANDIDATO'].localeCompare(b['NOME CANDIDATO']));

        let candidatesHtml = filteredData.map(cand => {
            const state = getCityState(cand.CIDADE);
            return `
            <tr class="border-b border-border hover:bg-background">
                <td class="py-3 px-4">${cand.CIDADE} (${state})</td>
                <td class="py-3 px-4">${cand["NOME CANDIDATO"]}</td>
                <td class="py-3 px-4">${cand.CARGO}</td>
                <td class="py-3 px-4">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${PARTY_COLORS[cand.PARTIDO] || '#64748b'}"></div>
                        <span>${cand.PARTIDO || 'N/A'}</span>
                    </div>
                </td>
                <td class="py-3 px-4 text-right font-mono">${cand.VOTOS}</td>
            </tr>
        `}).join('');

        const title = `${filterValue.toLowerCase()}s eleitos ${region === 'all' ? '' : 'na ' + region}`;

        const modalHtml = `
            <div class="p-6 text-text-light">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-secondary capitalize">${title}</h2>
                        <p>${filteredData.length} resultado(s) encontrado(s)</p>
                    </div>
                    <button onclick="closeModal()" class="text-text-light hover:text-text-main text-2xl">&times;</button>
                </div>
                <div class="overflow-y-auto max-h-[60vh]">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-900/50 sticky top-0">
                            <tr>
                                <th class="py-3 px-4">Cidade</th>
                                <th class="py-3 px-4">Nome</th>
                                <th class="py-3 px-4">Cargo</th>
                                <th class="py-3 px-4">Partido</th>
                                <th class="py-3 px-4 text-right">Votos</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${candidatesHtml}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        showModal(modalHtml);
    }
    </script>
</body>
</html>
